/*!
 * Mercury Editor is a CoffeeScript and jQuery based WYSIWYG editor.  Documentation and other useful information can be
 * found at https://github.com/jejacks0n/mercury
 *
 * Minimum jQuery requirements are 1.7

 *
 * You can include the Rails jQuery ujs script here to get some nicer behaviors in modals, panels and lightviews when
 * using :remote => true within the contents rendered in them.
 * require jquery_ujs
 *
 * Add any requires for the support libraries that integrate nicely with Mercury Editor.
 * require mercury/support/history
 *
 * Require Mercury Editor itself.

 *
 * Require any localizations you wish to support
 * Example: es.locale, or fr.locale -- regional dialects are in each language file so never en_US for instance.
 * Make sure you enable the localization feature in the configuration.
 * require mercury/locales/swedish_chef.locale
 *
 * Add all requires for plugins that extend or change the behavior of Mercury Editor.
 * require mercury/plugins/save_as_xml/plugin.js
 *
 * Require any files you want to use that either extend, or change the default Mercury behavior.
 * require mercury_overrides
 */
window.Mercury={config:{toolbars:{primary:{save:["Save","Save this page"],preview:["Preview","Preview this page",{toggle:!0,mode:!0}],sep1:" ",undoredo:{undo:["Undo","Undo your last action"],redo:["Redo","Redo your last action"],sep:" "},insertLink:["Link","Insert Link",{modal:"/mercury/modals/link.html",regions:["full","markdown"]}],insertMedia:["Media","Insert Media (images and videos)",{modal:"/mercury/modals/media.html",regions:["full","markdown"]}],insertTable:["Table","Insert Table",{modal:"/mercury/modals/table.html",regions:["full","markdown"]}],insertCharacter:["Character","Special Characters",{modal:"/mercury/modals/character.html",regions:["full","markdown"]}],snippetPanel:["Snippet","Snippet Panel",{panel:"/mercury/panels/snippets.html"}],sep2:" ",historyPanel:["History","Page Version History",{panel:"/mercury/panels/history.html"}],sep3:" ",notesPanel:["Notes","Page Notes",{panel:"/mercury/panels/notes.html"}]},editable:{_regions:["full","markdown"],predefined:{style:["Style",null,{select:"/mercury/selects/style.html",preload:!0}],sep1:" ",formatblock:["Block Format",null,{select:"/mercury/selects/formatblock.html",preload:!0}],sep2:"-"},colors:{backColor:["Background Color",null,{palette:"/mercury/palettes/backcolor.html",context:!0,preload:!0,regions:["full"]}],sep1:" ",foreColor:["Text Color",null,{palette:"/mercury/palettes/forecolor.html",context:!0,preload:!0,regions:["full"]}],sep2:"-"},decoration:{bold:["Bold",null,{context:!0}],italic:["Italicize",null,{context:!0}],overline:["Overline",null,{context:!0,regions:["full"]}],strikethrough:["Strikethrough",null,{context:!0,regions:["full"]}],underline:["Underline",null,{context:!0,regions:["full"]}],sep:"-"},script:{subscript:["Subscript",null,{context:!0}],superscript:["Superscript",null,{context:!0}],sep:"-"},justify:{justifyLeft:["Align Left",null,{context:!0,regions:["full"]}],justifyCenter:["Center",null,{context:!0,regions:["full"]}],justifyRight:["Align Right",null,{context:!0,regions:["full"]}],justifyFull:["Justify Full",null,{context:!0,regions:["full"]}],sep:"-"},list:{insertUnorderedList:["Unordered List",null,{context:!0}],insertOrderedList:["Numbered List",null,{context:!0}],sep:"-"},indent:{outdent:["Decrease Indentation"],indent:["Increase Indentation"],sep:"-"},table:{_context:!0,insertRowBefore:["Insert Table Row","Insert a table row before the cursor",{regions:["full"]}],insertRowAfter:["Insert Table Row","Insert a table row after the cursor",{regions:["full"]}],deleteRow:["Delete Table Row","Delete this table row",{regions:["full"]}],insertColumnBefore:["Insert Table Column","Insert a table column before the cursor",{regions:["full"]}],insertColumnAfter:["Insert Table Column","Insert a table column after the cursor",{regions:["full"]}],deleteColumn:["Delete Table Column","Delete this table column",{regions:["full"]}],sep1:" ",increaseColspan:["Increase Cell Columns","Increase the cells colspan"],decreaseColspan:["Decrease Cell Columns","Decrease the cells colspan and add a new cell"],increaseRowspan:["Increase Cell Rows","Increase the cells rowspan"],decreaseRowspan:["Decrease Cell Rows","Decrease the cells rowspan and add a new cell"],sep2:"-"},rules:{horizontalRule:["Horizontal Rule","Insert a horizontal rule"],sep1:"-"},formatting:{removeFormatting:["Remove Formatting","Remove formatting for the selection",{regions:["full"]}],sep2:" "},editors:{htmlEditor:["Edit HTML","Edit the HTML content",{regions:["full"]}]}},snippets:{_custom:!0,actions:{editSnippet:["Edit Snippet Settings"],sep1:" ",removeSnippet:["Remove Snippet"]}}},regions:{attribute:"data-mercury",identifier:"id",dataAttributes:[]},snippets:{method:"POST",optionsUrl:"/mercury/snippets/:name/options.html",previewUrl:"/mercury/snippets/:name/preview.html"},uploading:{enabled:!0,allowedMimeTypes:["image/jpeg","image/gif","image/png"],maxFileSize:1235242880,inputName:"image[image]",url:"/mercury/images",handler:!1},localization:{enabled:!1,preferredLocale:"swedish_chef-BORK"},behaviors:{htmlEditor:function(){Mercury.modal("/mercury/modals/htmleditor.html",{title:"HTML Editor",fullHeight:!0,handler:"htmlEditor"})}},globalBehaviors:{exit:function(){window.location.href=this.iframeSrc()},barrelRoll:function(){$("body").css({webkitTransform:"rotate(360deg)"})}},csrfSelector:'meta[name="csrf-token"]',csrfHeader:"X-CSRF-Token",editorUrlRegEx:/([http|https]:\/\/.[^\/]*)\/editor\/?(.*)/i,nonHijackableClasses:[],pasting:{sanitize:"whitelist",whitelist:{h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],table:[],thead:[],tbody:[],tfoot:[],tr:[],th:["colspan","rowspan"],td:["colspan","rowspan"],div:["class"],span:["class"],ul:[],ol:[],li:[],b:[],strong:[],i:[],em:[],u:[],strike:[],br:[],p:[],hr:[],a:["href","target","title","name"],img:["src","title","alt"]}},injectedStyles:'[data-mercury]       { min-height: 10px; outline: 1px dotted #09F } [data-mercury]:focus { outline: none; -webkit-box-shadow: 0 0 10px #09F, 0 0 1px #045; box-shadow: 0 0 10px #09F, 0 0 1px #045 }[data-mercury].focus { outline: none; -webkit-box-shadow: 0 0 10px #09F, 0 0 1px #045; box-shadow: 0 0 10px #09F, 0 0 1px #045 }[data-mercury]:after { content: "."; display: block; visibility: hidden; clear: both; height: 0; overflow: hidden; }[data-mercury] table { border: 1px dotted red; min-width: 6px; }[data-mercury] th    { border: 1px dotted red; min-width: 6px; }[data-mercury] td    { border: 1px dotted red; min-width: 6px; }[data-mercury] .mercury-textarea       { border: 0; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; resize: none; }[data-mercury] .mercury-textarea:focus { outline: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; }'},silent:!1,debug:!1},/*!
 * jQuery UI 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
function(t,e){function n(e,n){var r=e.nodeName.toLowerCase();return"area"===r?(n=e.parentNode,r=n.name,e.href&&r&&"map"===n.nodeName.toLowerCase()?(e=t("img[usemap=#"+r+"]")[0],!!e&&i(e)):!1):(/input|select|textarea|button|object/.test(r)?!e.disabled:"a"==r?e.href||n:n)&&i(e)}function i(e){return!t(e).parents().andSelf().filter(function(){return"hidden"===t.curCSS(this,"visibility")||t.expr.filters.hidden(this)}).length}t.ui=t.ui||{},t.ui.version||(t.extend(t.ui,{version:"1.8.13",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),t.fn.extend({_focus:t.fn.focus,focus:function(e,n){return"number"==typeof e?this.each(function(){var i=this;setTimeout(function(){t(i).focus(),n&&n.call(i)},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.curCSS(this,"position",1))&&/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(n){if(n!==e)return this.css("zIndex",n);if(this.length){n=t(this[0]);for(var i;n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(i=parseInt(n.css("zIndex"),10),!isNaN(i)&&0!==i))return i;n=n.parent()}}return 0},disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.each(["Width","Height"],function(n,i){function r(e,n,i,r){return t.each(o,function(){n-=parseFloat(t.curCSS(e,"padding"+this,!0))||0,i&&(n-=parseFloat(t.curCSS(e,"border"+this+"Width",!0))||0),r&&(n-=parseFloat(t.curCSS(e,"margin"+this,!0))||0)}),n}var o="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(n){return n===e?a["inner"+i].call(this):this.each(function(){t(this).css(s,r(this,n)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(s,r(this,e,!0,n)+"px")})}}),t.extend(t.expr[":"],{data:function(e,n,i){return!!t.data(e,i[3])},focusable:function(e){return n(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),r=isNaN(i);return(r||i>=0)&&n(e,!r)}}),t(function(){var e=document.body,n=e.appendChild(n=document.createElement("div"));t.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),t.support.minHeight=100===n.offsetHeight,t.support.selectstart="onselectstart"in n,e.removeChild(n).style.display="none"}),t.extend(t.ui,{plugin:{add:function(e,n,i){e=t.ui[e].prototype;for(var r in i)e.plugins[r]=e.plugins[r]||[],e.plugins[r].push([n,i[r]])},call:function(t,e,n){if((e=t.plugins[e])&&t.element[0].parentNode)for(var i=0;i<e.length;i++)t.options[e[i][0]]&&e[i][1].apply(t.element,n)}},contains:function(t,e){return document.compareDocumentPosition?16&t.compareDocumentPosition(e):t!==e&&t.contains(e)},hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;n=n&&"left"===n?"scrollLeft":"scrollTop";var i=!1;return e[n]>0?!0:(e[n]=1,i=e[n]>0,e[n]=0,i)},isOverAxis:function(t,e,n){return t>e&&e+n>t},isOver:function(e,n,i,r,o,s){return t.ui.isOverAxis(e,i,o)&&t.ui.isOverAxis(n,r,s)}}))}(jQuery),/*!
 * jQuery UI Widget 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function(t,e){if(t.cleanData){var n=t.cleanData;t.cleanData=function(e){for(var i,r=0;null!=(i=e[r]);r++)t(i).triggerHandler("remove");n(e)}}else{var i=t.fn.remove;t.fn.remove=function(e,n){return this.each(function(){return n||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){t(this).triggerHandler("remove")}),i.call(t(this),e,n)})}}t.widget=function(e,n,i){var r,o=e.split(".")[0];e=e.split(".")[1],r=o+"-"+e,i||(i=n,n=t.Widget),t.expr[":"][r]=function(n){return!!t.data(n,e)},t[o]=t[o]||{},t[o][e]=function(t,e){arguments.length&&this._createWidget(t,e)},n=new n,n.options=t.extend(!0,{},n.options),t[o][e].prototype=t.extend(!0,n,{namespace:o,widgetName:e,widgetEventPrefix:t[o][e].prototype.widgetEventPrefix||e,widgetBaseClass:r},i),t.widget.bridge(e,t[o][e])},t.widget.bridge=function(n,i){t.fn[n]=function(r){var o="string"==typeof r,s=Array.prototype.slice.call(arguments,1),a=this;return r=!o&&s.length?t.extend.apply(null,[!0,r].concat(s)):r,o&&"_"===r.charAt(0)?a:(this.each(o?function(){var i=t.data(this,n),o=i&&t.isFunction(i[r])?i[r].apply(i,s):i;return o!==i&&o!==e?(a=o,!1):void 0}:function(){var e=t.data(this,n);e?e.option(r||{})._init():t.data(this,n,new i(r,this))}),a)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,n){t.data(n,this.widgetName,this),this.element=t(n),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var i=this;this.element.bind("remove."+this.widgetName,function(){i.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(n,i){var r=n;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof n){if(i===e)return this.options[n];r={},r[n]=i}return this._setOptions(r),this},_setOptions:function(e){var n=this;return t.each(e,function(t,e){n._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,n,i){var r=this.options[e];if(n=t.Event(n),n.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i=i||{},n.originalEvent){e=t.event.props.length;for(var o;e;)o=t.event.props[--e],n[o]=n.originalEvent[o]}return this.element.trigger(n,i),!(t.isFunction(r)&&r.call(this.element[0],n,i)===!1||n.isDefaultPrevented())}}}(jQuery),/*!
 * jQuery UI Mouse 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
function(t){var e=!1;t(document).mousedown(function(){e=!1}),t.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(n){return!0===t.data(n.target,e.widgetName+".preventClickEvent")?(t.removeData(n.target,e.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(n){if(t(this.document||document).mousedown(function(){e=!1}),!e){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,r=1==n.which,o="string"==typeof this.options.cancel?t(n.target).parents().add(n.target).filter(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===t.data(n.target,this.widgetName+".preventClickEvent")&&t.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},t(this.document||document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return!t.browser.msie||(this.document||document).documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(this.document||document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),/*
 * jQuery UI Draggable 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.draggable",t.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(e){var n=this.options;return this.helper||n.disabled||t(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?(t(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var n=this.options;return this.helper=this._createHelper(e),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(e,!0),!0)},_mouseDrag:function(e,n){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!n){if(n=this._uiHash(),this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var n=!1;if(t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!n||"valid"==this.options.revert&&n||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var i=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()})}else this._trigger("stop",e)!==!1&&this._clear();return!1},_mouseUp:function(e){return this.options.iframeFix===!0&&t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var n=this.options.handle&&t(this.options.handle,this.element).length?!1:!0;return t(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(n=!0)}),n},_createHelper:function(e){var n=this.options;return e=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e])):"clone"==n.helper?this.element.clone().removeAttr("id"):this.element,e.parents("body").length||e.appendTo("parent"==n.appendTo?this.element[0].parentNode:n.appendTo),e[0]!=this.element[0]&&!/(fixed|absolute)/.test(e.css("position"))&&e.css("position","absolute"),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[("document"==e.containment?0:t(window).scrollLeft())-this.offset.relative.left-this.offset.parent.left,("document"==e.containment?0:t(window).scrollTop())-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{e=t(e.containment);var n=e[0];if(n){e.offset();var i="hidden"!=t(n).css("overflow");this.containment=[(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0),(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0),(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=e}}},_convertPositionTo:function(e,n){n||(n=this.position),e="absolute"==e?1:-1;var i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*e+this.offset.parent.top*e-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop())*e),left:n.left+this.offset.relative.left*e+this.offset.parent.left*e-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())*e)}},_generatePosition:function(e){var n=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName),o=e.pageX,s=e.pageY;if(this.originalPosition){var a;this.containment&&(this.relative_container?(a=this.relative_container.offset(),a=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]):a=this.containment,e.pageX-this.offset.click.left<a[0]&&(o=a[0]+this.offset.click.left),e.pageY-this.offset.click.top<a[1]&&(s=a[1]+this.offset.click.top),e.pageX-this.offset.click.left>a[2]&&(o=a[2]+this.offset.click.left),e.pageY-this.offset.click.top>a[3]&&(s=a[3]+this.offset.click.top)),n.grid&&(s=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1],s=a&&(s-this.offset.click.top<a[1]||s-this.offset.click.top>a[3])?s-this.offset.click.top<a[1]?s+n.grid[1]:s-n.grid[1]:s,o=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=a&&(o-this.offset.click.left<a[0]||o-this.offset.click.left>a[2])?o-this.offset.click.left<a[0]?o+n.grid[0]:o-n.grid[0]:o)}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,n,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[n,i]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.extend(t.ui.draggable,{version:"1.8.13"}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,n){var i=t(this).data("draggable"),r=i.options,o=t.extend({},n,{item:i.element});i.sortables=[],t(r.connectToSortable).each(function(){var n=t.data(this,"sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",e,o))})},stop:function(e,n){var i=t(this).data("draggable"),r=t.extend({},n,{item:i.element});t.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(e,n){var i=t(this).data("draggable"),r=this;t.each(i.sortables,function(){this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(r).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",e),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",e),i.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),n=t(this).data("draggable").options;e.css("cursor")&&(n._cursor=e.css("cursor")),e.css("cursor",n.cursor)},stop:function(){var e=t(this).data("draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n){e=t(n.helper),n=t(this).data("draggable").options,e.css("opacity")&&(n._opacity=e.css("opacity")),e.css("opacity",n.opacity)},stop:function(e,n){e=t(this).data("draggable").options,e._opacity&&t(n.helper).css("opacity",e._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("draggable");e.scrollParent[0]!=document&&"HTML"!=e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var n=t(this).data("draggable"),i=n.options,r=!1;n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName?(i.axis&&"x"==i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"==i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"==i.axis||(e.pageY-t(document).scrollTop()<i.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"==i.axis||(e.pageX-t(document).scrollLeft()<i.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed)))),r!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("draggable"),n=e.options;e.snapElements=[],t(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var n=t(this),i=n.offset();this!=e.element[0]&&e.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(e,n){for(var i=t(this).data("draggable"),r=i.options,o=r.snapTolerance,s=n.offset.left,a=s+i.helperProportions.width,l=n.offset.top,c=l+i.helperProportions.height,u=i.snapElements.length-1;u>=0;u--){var h=i.snapElements[u].left,d=h+i.snapElements[u].width,p=i.snapElements[u].top,f=p+i.snapElements[u].height;if(s>h-o&&d+o>s&&l>p-o&&f+o>l||s>h-o&&d+o>s&&c>p-o&&f+o>c||a>h-o&&d+o>a&&l>p-o&&f+o>l||a>h-o&&d+o>a&&c>p-o&&f+o>c){if("inner"!=r.snapMode){var m=Math.abs(p-c)<=o,g=Math.abs(f-l)<=o,v=Math.abs(h-a)<=o,y=Math.abs(d-s)<=o;m&&(n.position.top=i._convertPositionTo("relative",{top:p-i.helperProportions.height,left:0}).top-i.margins.top),g&&(n.position.top=i._convertPositionTo("relative",{top:f,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:h-i.helperProportions.width}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d}).left-i.margins.left)}var b=m||g||v||y;"outer"!=r.snapMode&&(m=Math.abs(p-l)<=o,g=Math.abs(f-c)<=o,v=Math.abs(h-s)<=o,y=Math.abs(d-a)<=o,m&&(n.position.top=i._convertPositionTo("relative",{top:p,left:0}).top-i.margins.top),g&&(n.position.top=i._convertPositionTo("relative",{top:f-i.helperProportions.height,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:h}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d-i.helperProportions.width}).left-i.margins.left)),!i.snapElements[u].snapping&&(m||g||v||y||b)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[u].item})),i.snapElements[u].snapping=m||g||v||y||b}else i.snapElements[u].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[u].item})),i.snapElements[u].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(){var e=t(this).data("draggable").options;if(e=t.makeArray(t(e.stack)).sort(function(e,n){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(n).css("zIndex"),10)||0)}),e.length){var n=parseInt(e[0].style.zIndex)||0;t(e).each(function(t){this.style.zIndex=n+t}),this[0].style.zIndex=n+e.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n){e=t(n.helper),n=t(this).data("draggable").options,e.css("zIndex")&&(n._zIndex=e.css("zIndex")),e.css("zIndex",n.zIndex)},stop:function(e,n){e=t(this).data("draggable").options,e._zIndex&&t(n.helper).css("zIndex",e._zIndex)}})}(jQuery),/*
 * jQuery UI Sortable 1.8.13
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(t){t.widget("ui.sortable",t.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var t=this.options;this.document=t.document,this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData("sortable-item");return this},_setOption:function(e,n){"disabled"===e?(this.options[e]=n,this.widget()[n?"addClass":"removeClass"]("ui-sortable-disabled")):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,n){if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(e);{var i=null,r=this;t(e.target).parents().each(function(){return t.data(this,"sortable-item")==r?(i=t(this),!1):void 0})}if(t.data(e.target,"sortable-item")==r&&(i=t(e.target)),!i)return!1;if(this.options.handle&&!n){var o=!1;if(t(this.options.handle,i).find("*").andSelf().each(function(){this==e.target&&(o=!0)}),!o)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(e,n,i){var r=this.options,o=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&(t("body").css("cursor")&&(this._storedCursor=t("body").css("cursor")),t("body").css("cursor",r.cursor)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!=(this.document||document)&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",e,o._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var n=this.options,i=!1;this.scrollParent[0]!=(this.document||document)&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(e.pageY-t(this.document||document).scrollTop()<n.scrollSensitivity?i=t(this.document||document).scrollTop(t(this.document||document).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(this.document||document).scrollTop())<n.scrollSensitivity&&(i=t(this.document||document).scrollTop(t(this.document||document).scrollTop()+n.scrollSpeed)),e.pageX-t(this.document||document).scrollLeft()<n.scrollSensitivity?i=t(this.document||document).scrollLeft(t(this.document||document).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(this.document||document).scrollLeft())<n.scrollSensitivity&&(i=t(this.document||document).scrollLeft(t(this.document||document).scrollLeft()+n.scrollSpeed))),i!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var r=this.items.length-1;r>=0;r--){var o=this.items[r],s=o.item[0],a=this._intersectsWithPointer(o);if(a&&s!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=s&&!t.ui.contains(this.placeholder[0],s)&&("semi-dynamic"==this.options.type?!t.ui.contains(this.element[0],s):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(e,o),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,n){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var i=this,r=i.placeholder.offset();i.reverting=!0,t(this.helper).animate({left:r.left-this.offset.parent.left-i.margins.left+(this.offsetParent[0]==(this.document||document).body?0:this.offsetParent[0].scrollLeft),top:r.top-this.offset.parent.top-i.margins.top+(this.offsetParent[0]==(this.document||document).body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,n);return!1}},cancel:function(){var e=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("deactivate",null,e._uiHash(this)),this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",null,e._uiHash(this)),this.containers[n].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t(n).each(function(){var n=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);n&&i.push((e.key||n[1]+"[]")+"="+(e.key&&e.expression?n[1]:n[2]))}),!i.length&&e.key&&i.push(e.key+"="),i.join("&")},toArray:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},n.each(function(){i.push(t(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(t){var e=this.positionAbs.left,n=e+this.helperProportions.width,i=this.positionAbs.top,r=i+this.helperProportions.height,o=t.left,s=o+t.width,a=t.top,l=a+t.height,c=this.offset.click.top,u=this.offset.click.left,h=i+c>a&&l>i+c&&e+u>o&&s>e+u;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?h:o<e+this.helperProportions.width/2&&n-this.helperProportions.width/2<s&&a<i+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var n=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=n&&i,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"==s||"down"==o?2:1:o&&("down"==o?2:1):!1},_intersectsWithSides:function(e){var n=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"==o&&i||"left"==o&&!i:r&&("down"==r&&n||"up"==r&&!n)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor==String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var n=[],i=[],r=this._connectWith();if(r&&e)for(var o=r.length-1;o>=0;o--)for(var s=t(r[o]),a=s.length-1;a>=0;a--){var l=t.data(s[a],"sortable");l&&l!=this&&!l.options.disabled&&i.push([t.isFunction(l.options.items)?l.options.items.call(l.element):t(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}i.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var o=i.length-1;o>=0;o--)i[o][0].each(function(){n.push(this)});return t(n)},_removeCurrentsFromItems:function(){for(var t=this.currentItem.find(":data(sortable-item)"),e=0;e<this.items.length;e++)for(var n=0;n<t.length;n++)t[n]==this.items[e].item[0]&&this.items.splice(e,1)},_refreshItems:function(e){this.items=[],this.containers=[this];var n=this.items,i=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],r=this._connectWith();if(r)for(var o=r.length-1;o>=0;o--)for(var s=t(r[o]),a=s.length-1;a>=0;a--){var l=t.data(s[a],"sortable");l&&l!=this&&!l.options.disabled&&(i.push([t.isFunction(l.options.items)?l.options.items.call(l.element[0],e,{item:this.currentItem}):t(l.options.items,l.element),l]),this.containers.push(l))}for(var o=i.length-1;o>=0;o--)for(var c=i[o][1],u=i[o][0],a=0,h=u.length;h>a;a++){var d=t(u[a]);d.data("sortable-item",c),n.push({item:d,instance:c,width:0,height:0,left:0,top:0})}},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var i=this.items[n];if(i.instance==this.currentContainer||!this.currentContainer||i.item[0]==this.currentItem[0]){var r=this.options.toleranceElement?t(this.options.toleranceElement,i.item):i.item;e||(i.width=r.outerWidth(),i.height=r.outerHeight());var o=r.offset();i.left=o.left,i.top=o.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var o=this.containers[n].element.offset();this.containers[n].containerCache.left=o.left,this.containers[n].containerCache.top=o.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(e){var n=e||this,i=n.options;if(!i.placeholder||i.placeholder.constructor==String){var r=i.placeholder;i.placeholder={element:function(){var e=t((this.document||document).createElement(n.currentItem[0].nodeName)).addClass(r||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(e.style.visibility="hidden"),e},update:function(t,e){(!r||i.forcePlaceholderSize)&&(e.height()||e.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10)))}}}n.placeholder=t(i.placeholder.element.call(n.element,n.currentItem)),n.currentItem.after(n.placeholder),i.placeholder.update(n,n.placeholder)},_contactContainers:function(e){for(var n=null,i=null,r=this.containers.length-1;r>=0;r--)if(!t.ui.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(n&&t.ui.contains(this.containers[r].element[0],n.element[0]))continue;n=this.containers[r],i=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",e,this._uiHash(this)),this.containers[r].containerCache.over=0);if(n)if(1===this.containers.length)this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1;else if(this.currentContainer!=this.containers[i]){for(var o=1e4,s=null,a=this.positionAbs[this.containers[i].floating?"left":"top"],l=this.items.length-1;l>=0;l--)if(t.ui.contains(this.containers[i].element[0],this.items[l].item[0])){var c=this.items[l][this.containers[i].floating?"left":"top"];Math.abs(c-a)<o&&(o=Math.abs(c-a),s=this.items[l])}if(!s&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[i],s?this._rearrange(e,s,null,!0):this._rearrange(e,null,this.containers[i].element,!0),this._trigger("change",e,this._uiHash()),this.containers[i]._trigger("change",e,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1}},_createHelper:function(e){var n=this.options,i=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e,this.currentItem])):"clone"==n.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||t("parent"!=n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==i[0].style.width||n.forceHelperSize)&&i.width(this.currentItem.width()),(""==i[0].style.height||n.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=(this.document||document)&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==(this.document||document).body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"==e.containment?this.document||document:window).width()-this.helperProportions.width-this.margins.left,(t("document"==e.containment?this.document||document:window).height()||(this.document||document).body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(e.containment)){var n=t(e.containment)[0],i=t(e.containment).offset(),r="hidden"!=t(n).css("overflow");this.containment=[i.left+(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,n){n||(n=this.position);var i="absolute"==e?1:-1,r=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*i),left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*i)}},_generatePosition:function(e){var n=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=(this.document||document)&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var o=e.pageX,s=e.pageY;if(this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),n.grid)){var a=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1];s=this.containment&&(a-this.offset.click.top<this.containment[1]||a-this.offset.click.top>this.containment[3])?a-this.offset.click.top<this.containment[1]?a+n.grid[1]:a-n.grid[1]:a;var l=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0];o=this.containment&&(l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2])?l-this.offset.click.left<this.containment[0]?l+n.grid[0]:l-n.grid[0]:l}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())}},_rearrange:function(t,e,n,i){n?n[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this,o=this.counter;window.setTimeout(function(){o==r.counter&&r.refreshPositions(!i)},0)},_clear:function(e,n){this.reverting=!1;var i=[];if(!this._noFinalSort&&this.currentItem[0].parentNode&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var r in this._storedCSS)("auto"==this._storedCSS[r]||"static"==this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!n&&i.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||n||i.push(function(t){this._trigger("update",t,this._uiHash())}),!t.ui.contains(this.element[0],this.currentItem[0])){n||i.push(function(t){this._trigger("remove",t,this._uiHash())});for(var r=this.containers.length-1;r>=0;r--)t.ui.contains(this.containers[r].element[0],this.currentItem[0])&&!n&&(i.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[r])),i.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.containers[r])))}for(var r=this.containers.length-1;r>=0;r--)n||i.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this._storedCursor&&t("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",e,this._uiHash());for(var r=0;r<i.length;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return!1}if(n||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!n){for(var r=0;r<i.length;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var n=e||this;return{helper:n.helper,placeholder:n.placeholder||t([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:e?e.element:null}}}),t.extend(t.ui.sortable,{version:"1.8.13"})}(jQuery),!function(t){t.serializeObject=function(e){var n={},i=n,r=e;return t.each(r,function(){for(var t=this.name.replace(/\[([^\]]+)?\]/g,",$1").split(","),e=t.length-1,r=0;e>r;r++)i.push?(i[i.length-1]&&i[i.length-1].constructor===Object&&void 0===i[i.length-1][t[r+1]]||i.push({}),i=i[i.length-1]):i=i[t[r]]=i[t[r]]||(""==t[r+1]?[]:{});i.push?i.push(this.value):i[t[e]]=this.value,i=n}),n},t.deserializeObject=function n(t,e,i){var r,o,s,a;if(e=e||[],"[object Object]"===Object.prototype.toString.call(t)){for(r in t)if(s=i?[i,"[",r,"]"].join(""):r,t.hasOwnProperty(r))if(a=Object.prototype.toString.call(t[r]),"[object Array]"===a)for(o=0,jsonLen=t[r].length;o<jsonLen;o++)n(t[r][o],e,s+"[]");else"[object Object]"===a?n(t[r],e,s):e.push({name:s,value:t[r]})}else e.push({name:i,value:t});return e};var e=function(){var e=!!t.fn.prop;return function(t,n){e?t.prop("checked",n):t.attr("checked",n?"checked":null)}}();t.applySerializedArray=function(n,i){var r,o=t(n).find("input,select,textarea");e(o.filter(":checked"),!1);for(var s=i.length;s--;)r=o.filter("[name='"+i[s].name+"']"),r.filter(":checkbox").length?r.val()==i[s].value&&e(r.filter(":checkbox"),!0):r.filter(":radio").length?e(r.filter("[value='"+i[s].value+"']"),!0):r.val(i[s].value)},t.applySerializedObject=function(e,n){t.applySerializedArray(e,t.deserializeObject(n))},t.fn.serializeObject=t.fn.serializeObject||function(){return t.serializeObject(this.serializeArray())},t.fn.applySerializedObject=function(e){return t.applySerializedObject(this,e),this},t.fn.applySerializedArray=function(e){return t.applySerializedArray(this,e),this}}(jQuery),/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1 to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 *
 * Open source under the BSD License.
 *
 * Copyright © 2008 George McGinley Smith
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
 * following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer.  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
 * the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
jQuery.extend(jQuery.easing,{easeInSine:function(t,e,n,i,r){return-i*Math.cos(e/r*(Math.PI/2))+i+n},easeOutSine:function(t,e,n,i,r){return i*Math.sin(e/r*(Math.PI/2))+n},easeInOutSine:function(t,e,n,i,r){return-i/2*(Math.cos(Math.PI*e/r)-1)+n}}),/*
 * jQuery JSON Plugin version: 2.1 (2009-08-14)
 *
 * This document is licensed as free software under the terms of the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Brantley Harris wrote this plugin. It is based somewhat on the JSON.org  website's http://www.json.org/json2.js,
 * which proclaims: "NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.", a sentiment that I uphold.
 *
 * It is also influenced heavily by MochiKit's serializeJSON, which is  copyrighted 2005 by Bob Ippolito.
 */
function(t){t.toJSON=function(e){if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(e);var n=typeof e;if(null===e)return"null";if("undefined"==n)return void 0;if("number"==n||"boolean"==n)return e+"";if("string"==n)return t.quoteString(e);if("object"==n){if("function"==typeof e.toJSON)return t.toJSON(e.toJSON());if(e.constructor===Date){var i=e.getUTCFullYear(),r=e.getUTCMonth()+1;10>r&&(r="0"+r);var o=e.getUTCDate();10>o&&(o="0"+o);var s=e.getUTCHours();10>s&&(s="0"+s);var a=e.getUTCMinutes();10>a&&(a="0"+a);var l=e.getUTCSeconds();10>l&&(l="0"+l);var c=e.getUTCMilliseconds();return 100>c&&(c="0"+c),10>c&&(c="0"+c),'"'+i+"-"+r+"-"+o+"T"+s+":"+a+":"+l+"."+c+'Z"'}if(e.constructor===Array){for(var u=[],h=0;h<e.length;h++)u.push(t.toJSON(e[h])||"null");return"["+u.join(",")+"]"}var d=[];for(var p in e){var f;if(n=typeof p,"number"==n)f='"'+p+'"';else{if("string"!=n)continue;f=t.quoteString(p)}if("function"!=typeof e[p]){var m=t.toJSON(e[p]);d.push(f+":"+m)}}return"{"+d.join(", ")+"}"}},t.quoteString=function(t){return t.match(e)?'"'+t.replace(e,function(t){var e=n[t];return"string"==typeof e?e:(e=t.charCodeAt(),"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16))})+'"':'"'+t+'"'};var e=/["\\\x00-\x1f\x7f-\x9f]/g,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}(jQuery),/*
 * jQuery Localizer Plugin
 *
 * Copyright (c) 2011 Sagi Mann (with a basic reworking by Jeremy Jackson)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms are permitted provided that the above copyright notice and this
 * paragraph are duplicated in all such forms and that any documentation, advertising materials, and other materials
 * related to such distribution and use acknowledge that the software was developed by the <organization>.  The name of
 * the University may not be used to endorse or promote products derived from this software without specific prior
 * written permission.
 *
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 */
function(t){t.fn.localize=function(e){this.find("*").contents().each(function(){var n=!1,i="";return"string"==typeof this.data&&(i=t.trim(this.data),i&&(n=e.sub[i]||e.top[i])&&(this.data=n)),"IMG"==this.nodeName&&this.attributes.src&&(i=this.attributes.src.nodeValue,i&&(n=e.sub[i]||e.top[i])&&t(this).attr("src",n)),"A"==this.nodeName&&this.attributes.href&&(i=t.trim(this.attributes.href.nodeValue),i&&(n=e.sub[i]||e.top[i])&&t(this).attr("href",n)),"INPUT"==this.nodeName&&this.attributes.type&&this.attributes.value&&["submit","reset","button"].indexOf(this.attributes.type.nodeValue.toLowerCase())>-1&&(i=t.trim(this.attributes.value.nodeValue),i&&(n=e.sub[i]||e.top[i])&&t(this).attr("value",n)),this})}}(jQuery),function(t){function e(t,e,n,i){if(!t.tag.isInline&&n.length>0){n.push("\n");for(var r=0;i>r;r++)n.push("	")}}function n(i,r){var o=[],s=0==i.attributes.length,h=0,p=null,f=i.tag.render&&(0==r.allowedTags.length||t.inArray(i.tag.name,r.allowedTags)>-1)&&(0==r.removeTags.length||-1==t.inArray(i.tag.name,r.removeTags));if(!i.isRoot&&f&&(o.push("<"),o.push(i.tag.name),t.each(i.attributes,function(){if(-1==t.inArray(this.name,r.removeAttrs)){var e=new RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),n=e[2],s=e[1]||"'";"class"==this.name&&(n=t.grep(n.split(" "),function(e){return t.grep(r.allowedClasses,function(n){return n[0]==e&&(1==n.length||t.inArray(i.tag.name,n[1])>-1)}).length>0}).join(" "),s="'"),null!=n&&(n.length>0||t.inArray(this.name,i.tag.requiredAttributes)>-1)&&(o.push(" "),o.push(this.name),o.push("="),o.push(s),o.push(n),o.push(s))}})),i.tag.isSelfClosing)f&&o.push(" />"),s=!1;else if(i.tag.isNonClosing)s=!1;else{if(!i.isRoot&&f&&o.push(">"),h=r.formatIndent++,i.tag.toProtect)p=t.htmlClean.trim(i.children.join("")).replace(/<br>/gi,"\n"),o.push(p),s=0==p.length,r.formatIndent--;else{p=[];for(var m=0;m<i.children.length;m++){var g=i.children[m],v=t.htmlClean.trim(d(c(g)?g:g.childrenToString()));u(g)&&m>0&&v.length>0&&(a(g)||l(i.children[m-1]))&&p.push(" "),c(g)?v.length>0&&p.push(v):(m!=i.children.length-1||"br"!=g.tag.name)&&(r.format&&e(g,r,p,h),p=p.concat(n(g,r)))}r.formatIndent--,p.length>0&&(r.format&&"\n"!=p[0]&&e(i,r,o,h),o=o.concat(p),s=!1)}!i.isRoot&&f&&(r.format&&e(i,r,o,h-1),o.push("</"),o.push(i.tag.name),o.push(">"))}return!i.tag.allowEmpty&&s?[]:o}function i(e,n,r){return r=r||1,t.inArray(e[e.length-r].tag.name,n)>-1?!0:e.length-(r+1)>0&&i(e,n,r+1)?(e.pop(),!0):!1}function r(t){return t?(this.tag=t,this.isRoot=!1):(this.tag=new s("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name==t)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function o(t,e){return this.name=t,this.value=e,this}function s(e,n,i,r){return this.name=e.toLowerCase(),this.isSelfClosing=t.inArray(this.name,y)>-1,this.isNonClosing=t.inArray(this.name,b)>-1,this.isClosing=void 0!=n&&n.length>0,this.isInline=t.inArray(this.name,p)>-1,this.disallowNest=t.inArray(this.name,f)>-1,this.requiredParent=g[t.inArray(this.name,g)+1],this.allowEmpty=t.inArray(this.name,m)>-1,this.toProtect=t.inArray(this.name,v)>-1,this.rawAttributes=i,this.allowedAttributes=w[t.inArray(this.name,w)+1],this.requiredAttributes=x[t.inArray(this.name,x)+1],this.render=r&&-1==t.inArray(this.name,r.notRenderedTags),this}function a(e){for(;h(e)&&e.children.length>0;)e=e.children[0];return c(e)&&e.length>0&&t.htmlClean.isWhitespace(e.charAt(0))}function l(e){for(;h(e)&&e.children.length>0;)e=e.children[e.children.length-1];return c(e)&&e.length>0&&t.htmlClean.isWhitespace(e.charAt(e.length-1))}function c(t){return t.constructor==String}function u(t){return c(t)||t.tag.isInline}function h(t){return t.constructor==r}function d(t){return t.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}t.fn.htmlClean=function(e){return this.each(function(){this.value?this.value=t.htmlClean(this.value,e):this.innerHTML=t.htmlClean(this.innerHTML,e)})},t.htmlClean=function(e,a){a=t.extend({},t.htmlClean.defaults,a);var l,u=/<(\/)?(\w+:)?([\w]+)([^>]*)>/gi,h=/(\w+)=(".*?"|'.*?'|[^\s>]*)/gi,d=new r,p=[d],f=d;a.bodyOnly&&(l=/<body[^>]*>((\n|.)*)<\/body>/i.exec(e))&&(e=l[1]),e=e.concat("<xxx>");for(var m;l=u.exec(e);){var g=new s(l[3],l[1],l[4],a),v=e.substring(m,l.index);if(v.length>0){var y=f.children[f.children.length-1];f.children.length>0&&c(y=f.children[f.children.length-1])?f.children[f.children.length-1]=y.concat(v):f.children.push(v)}if(m=u.lastIndex,g.isClosing)i(p,[g.name])&&(p.pop(),f=p[p.length-1]);else{for(var b,w=new r(g);b=h.exec(g.rawAttributes);){if("style"==b[1].toLowerCase()&&a.replaceStyles)for(var x=!g.isInline,C=0;C<a.replaceStyles.length;C++)a.replaceStyles[C][0].test(b[2])&&(x||(g.render=!1,x=!0),f.children.push(w),p.push(w),f=w,g=new s(a.replaceStyles[C][1],"","",a),w=new r(g));null!=g.allowedAttributes&&(0==g.allowedAttributes.length||t.inArray(b[1],g.allowedAttributes)>-1)&&w.attributes.push(new o(b[1],b[2]))}t.each(g.requiredAttributes,function(){var t=this.toString();w.hasAttribute(t)||w.attributes.push(new o(t,""))});for(var T=0;T<a.replace.length;T++)for(var S=0;S<a.replace[T][0].length;S++){var k="string"==typeof a.replace[T][0][S];if(k&&a.replace[T][0][S]==g.name||!k&&a.replace[T][0][S].test(l)){g.render=!1,f.children.push(w),p.push(w),f=w,g=new s(a.replace[T][1],l[1],l[4],a),w=new r(g),w.attributes=f.attributes,T=a.replace.length;break}}var M=!0;if(f.isRoot||(f.tag.isInline&&!g.isInline?M=!1:f.tag.disallowNest&&g.disallowNest&&!g.requiredParent?M=!1:g.requiredParent&&(M=i(p,g.requiredParent))&&(f=p[p.length-1])),M)if(f.children.push(w),g.toProtect)for(var E=null;E=u.exec(e);){var D=new s(E[3],E[1],E[4],a);if(D.isClosing&&D.name==g.name){w.children.push(RegExp.leftContext.substring(m)),m=u.lastIndex;break}}else g.isSelfClosing||g.isNonClosing||(p.push(w),f=w)}}return n(d,a).join("")},t.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],removeAttrs:[],allowedClasses:[],notRenderedTags:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]]},t.htmlClean.trim=function(e){return t.htmlClean.trimStart(t.htmlClean.trimEnd(e))},t.htmlClean.trimStart=function(e){return e.substring(t.htmlClean.trimStartIndex(e))},t.htmlClean.trimStartIndex=function(e){for(var n=0;n<e.length-1&&t.htmlClean.isWhitespace(e.charAt(n));n++);return n},t.htmlClean.trimEnd=function(e){return e.substring(0,t.htmlClean.trimEndIndex(e))},t.htmlClean.trimEndIndex=function(e){for(var n=e.length-1;n>=0&&t.htmlClean.isWhitespace(e.charAt(n));n--);return n+1},t.htmlClean.isWhitespace=function(e){return-1!=t.inArray(e,C)};var p=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","samp","select","small","span","strong","sub","sup","tt","var"],f=["h1","h2","h3","h4","h5","h6","p","th","td"],m=["th","td"],g=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"]],v=["script","style","pre","code"],y=["br","hr","img","link","meta"],b=["!doctype","?xml"],w=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"td",["colspan","rowspan"],"th",["colspan","rowspan"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"]],x=[[],"img",["alt"]],C=["\xa0"," ","	","\n","\r","\f"]}(jQuery);/*
 * LiquidMetal, version: 0.1 (2009-02-05)
 *
 * A mimetic poly-alloy of Quicksilver's scoring algorithm, essentially
 * LiquidMetal.
 *
 * For usage and examples, visit:
 * http://github.com/rmm5t/liquidmetal
 *
 * Licensed under the MIT:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright (c) 2009, Ryan McGeary (ryanonjavascript -[at]- mcgeary [*dot*] org)
 */
var LiquidMetal=function(){function t(t,e){var n=t.charAt(e);return n>="A"&&"Z">=n}function e(t,e){var n=t.charAt(e-1);return" "==n||"	"==n}function n(t,e,n,i){n=Math.max(n||0,0),i=Math.min(i||t.length,t.length);for(var r=n;i>r;r++)t[r]=e;return t}var i=0,r=1,o=.8,s=.9,a=.85;return{score:function(t,e){if(0==e.length)return o;if(e.length>t.length)return i;for(var n=this.buildScoreArray(t,e),r=0,s=0;s<n.length;s++)r+=n[s];return r/n.length},buildScoreArray:function(l,c){for(var u=new Array(l.length),h=l.toLowerCase(),d=c.toLowerCase().split(""),p=-1,f=!1,m=0;m<d.length;m++){var g=d[m],v=h.indexOf(g,p+1);if(0>v)return n(u,i);0==v&&(f=!0),e(l,v)?(u[v-1]=1,n(u,a,p+1,v-1)):t(l,v)?n(u,a,p+1,v):n(u,i,p+1,v),u[v]=r,p=v}var y=f?s:o;return n(u,y,p+1),u}}}(),Showdown={};Showdown.converter=function(){var t,e,n,i=0;this.makeHtml=function(i){return t=new Array,e=new Array,n=new Array,i=i.replace(/~/g,"~T"),i=i.replace(/\$/g,"~D"),i=i.replace(/\r\n/g,"\n"),i=i.replace(/\r/g,"\n"),i="\n\n"+i+"\n\n",i=_(i),i=i.replace(/^[ \t]+$/gm,""),i=a(i),i=s(i),i=c(i),i=N(i),i=i.replace(/~D/g,"$$"),i=i.replace(/~T/g,"~"),i=i.replace(/https?\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!]/g,function(t,e){var n=i.slice(0,e),r=i.slice(e);if(n.match(/<[^>]+$/)&&r.match(/^[^>]*>/))return t;var o=t.replace(/^http:\/\/github.com\//,"https://github.com/");return"<a href='"+o+"'>"+t+"</a>"}),i=i.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9-]+)+/gi,function(t){return"<a href='mailto:"+t+"'>"+t+"</a>"}),i=i.replace(/[a-f0-9]{40}/gi,function(t,e){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return t;var n=i.slice(0,e),r=i.slice(e);return n.match(/@$/)||n.match(/<[^>]+$/)&&r.match(/^[^>]*>/)?t:"<a href='http://github.com/"+GitHub.nameWithOwner+"/commit/"+t+"'>"+t.substring(0,7)+"</a>"}),i=i.replace(/([a-z0-9_\-+=.]+)@([a-f0-9]{40})/gi,function(t,e,n,r){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return t;GitHub.repoName=GitHub.repoName||o();var s=i.slice(0,r),a=i.slice(r);return s.match(/\/$/)||s.match(/<[^>]+$/)&&a.match(/^[^>]*>/)?t:"<a href='http://github.com/"+e+"/"+GitHub.repoName+"/commit/"+n+"'>"+e+"@"+n.substring(0,7)+"</a>"}),i=i.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)@([a-f0-9]{40})/gi,function(t,e,n){return"<a href='http://github.com/"+e+"/commit/"+n+"'>"+e+"@"+n.substring(0,7)+"</a>"}),i=i.replace(/#([0-9]+)/gi,function(t,e,n){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return t;var r=i.slice(0,n),o=i.slice(n);return""==r||r.match(/[a-z0-9_\-+=.]$/)||r.match(/<[^>]+$/)&&o.match(/^[^>]*>/)?t:"<a href='http://github.com/"+GitHub.nameWithOwner+"/issues/#issue/"+e+"'>"+t+"</a>"}),i=i.replace(/([a-z0-9_\-+=.]+)#([0-9]+)/gi,function(t,e,n,r){if("undefined"==typeof GitHub||"undefined"==typeof GitHub.nameWithOwner)return t;GitHub.repoName=GitHub.repoName||o();var s=i.slice(0,r),a=i.slice(r);return s.match(/\/$/)||s.match(/<[^>]+$/)&&a.match(/^[^>]*>/)?t:"<a href='http://github.com/"+e+"/"+GitHub.repoName+"/issues/#issue/"+n+"'>"+t+"</a>"}),i=i.replace(/([a-z0-9_\-+=.]+\/[a-z0-9_\-+=.]+)#([0-9]+)/gi,function(t,e,n){return"<a href='http://github.com/"+e+"/issues/#issue/"+n+"'>"+t+"</a>"})};var r,o=function(){return GitHub.nameWithOwner.match(/^.+\/(.+)$/)[1]},s=function(n){var n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(n,i,r,o,s){return i=i.toLowerCase(),t[i]=k(r),o?o+s:(s&&(e[i]=s.replace(/"/g,"&quot;")),"")});return n},a=function(t){t=t.replace(/\n/g,"\n\n");return t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l),t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l),t=t.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l),t=t.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,l),t=t.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l),t=t.replace(/\n\n/g,"\n")},l=function(t,e){var i=e;return i=i.replace(/\n\n/g,"\n"),i=i.replace(/^\n/,""),i=i.replace(/\n+$/g,""),i="\n\n~K"+(n.push(i)-1)+"K\n\n"},c=function(t){t=g(t);var e=b("<hr />");return t=t.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,e),t=v(t),t=y(t),t=T(t),t=a(t),t=S(t)},u=function(t){return t=w(t),t=h(t),t=M(t),t=f(t),t=d(t),t=E(t),t=k(t),t=C(t),t=t.replace(/  +\n/g," <br />\n")},h=function(t){var e=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return t=t.replace(e,function(t){var e=t.replace(/(.)<\/?code>(?=.)/g,"$1`");return e=j(e,"\\`*_")})},d=function(t){return t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),t=t.replace(/(\[([^\[\]]+)\])()()()()()/g,p)},p=function(n,i,r,o,s,a,l,c){void 0==c&&(c="");var u=i,h=r,d=o.toLowerCase(),p=s,f=c;if(""==p)if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),p="#"+d,void 0!=t[d])p=t[d],void 0!=e[d]&&(f=e[d]);else{if(!(u.search(/\(\s*\)$/m)>-1))return u;p=""}p=j(p,"*_");var m='<a href="'+p+'"';return""!=f&&(f=f.replace(/"/g,"&quot;"),f=j(f,"*_"),m+=' title="'+f+'"'),m+=">"+h+"</a>"},f=function(t){return t=t.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,m),t=t.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,m)},m=function(n,i,r,o,s,a,l,c){var u=i,h=r,d=o.toLowerCase(),p=s,f=c;if(f||(f=""),""==p){if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),p="#"+d,void 0==t[d])return u;p=t[d],void 0!=e[d]&&(f=e[d])}h=h.replace(/"/g,"&quot;"),p=j(p,"*_");var m='<img src="'+p+'" alt="'+h+'"';return f=f.replace(/"/g,"&quot;"),f=j(f,"*_"),m+=' title="'+f+'"',m+=" />"},g=function(t){return t=t.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(t,e){return b("<h1>"+u(e)+"</h1>")}),t=t.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(t,e){return b("<h2>"+u(e)+"</h2>")}),t=t.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(t,e,n){var i=e.length;return b("<h"+i+">"+u(n)+"</h"+i+">")})},v=function(t){t+="~0";var e=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return i?t=t.replace(e,function(t,e,n){var i=e,o=n.search(/[*+-]/g)>-1?"ul":"ol";i=i.replace(/\n{2,}/g,"\n\n\n");var s=r(i);return s=s.replace(/\s+$/,""),s="<"+o+">"+s+"</"+o+">\n"}):(e=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,t=t.replace(e,function(t,e,n,i){var o=e,s=n,a=i.search(/[*+-]/g)>-1?"ul":"ol",s=s.replace(/\n{2,}/g,"\n\n\n"),l=r(s);return l=o+"<"+a+">\n"+l+"</"+a+">\n"})),t=t.replace(/~0/,"")};r=function(t){return i++,t=t.replace(/\n{2,}$/,"\n"),t+="~0",t=t.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(t,e,n,i,r){var o=r,s=e;return s||o.search(/\n{2,}/)>-1?o=c(A(o)):(o=v(A(o)),o=o.replace(/\n$/,""),o=u(o)),"<li>"+o+"</li>\n"}),t=t.replace(/~0/g,""),i--,t};var y=function(t){return t+="~0",t=t.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(t,e,n){var i=e,r=n;return i=x(A(i)),i=_(i),i=i.replace(/^\n+/g,""),i=i.replace(/\n+$/g,""),i="<pre><code>"+i+"\n</code></pre>",b(i)+r}),t=t.replace(/~0/,"")},b=function(t){return t=t.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(t)-1)+"K\n\n"},w=function(t){return t=t.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(t,e,n,i){var r=i;return r=r.replace(/^([ \t]*)/g,""),r=r.replace(/[ \t]*$/g,""),r=x(r),e+"<code>"+r+"</code>"})},x=function(t){return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=j(t,"*_{}[]\\",!1)},C=function(t){return t=t.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),t=t.replace(/(\w)_(\w)/g,"$1~E95E$2"),t=t.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},T=function(t){return t=t.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(t,e){var n=e;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=c(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(t,e){var n=e;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),b("<blockquote>\n"+n+"\n</blockquote>")})},S=function(t){t=t.replace(/^\n+/g,""),t=t.replace(/\n+$/g,"");for(var e=t.split(/\n{2,}/g),i=new Array,r=e.length,o=0;r>o;o++){var s=e[o];s.search(/~K(\d+)K/g)>=0?i.push(s):s.search(/\S/)>=0&&(s=u(s),s=s.replace(/\n/g,"<br />"),s=s.replace(/^([ \t]*)/g,"<p>"),s+="</p>",i.push(s))}r=i.length;for(var o=0;r>o;o++)for(;i[o].search(/~K(\d+)K/)>=0;){var a=n[RegExp.$1];a=a.replace(/\$/g,"$$$$"),i[o]=i[o].replace(/~K\d+K/,a)}return i.join("\n\n")},k=function(t){return t=t.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),t=t.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},M=function(t){return t=t.replace(/\\(\\)/g,I),t=t.replace(/\\([`*_{}\[\]()>#+-.!])/g,I)},E=function(t){return t=t.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),t=t.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(t,e){return D(N(e))})},D=function(t){function e(t){var e="0123456789ABCDEF",n=t.charCodeAt(0);return e.charAt(n>>4)+e.charAt(15&n)}var n=[function(t){return"&#"+t.charCodeAt(0)+";"},function(t){return"&#x"+e(t)+";"},function(t){return t}];return t="mailto:"+t,t=t.replace(/./g,function(t){if("@"==t)t=n[Math.floor(2*Math.random())](t);else if(":"!=t){var e=Math.random();t=e>.9?n[2](t):e>.45?n[1](t):n[0](t)}return t}),t='<a href="'+t+'">'+t+"</a>",t=t.replace(/">.+:/g,'">')},N=function(t){return t=t.replace(/~E(\d+)E/g,function(t,e){var n=parseInt(e);return String.fromCharCode(n)})},A=function(t){return t=t.replace(/^(\t|[ ]{1,4})/gm,"~0"),t=t.replace(/~0/g,"")},_=function(t){return t=t.replace(/\t(?=\t)/g,"    "),t=t.replace(/\t/g,"~A~B"),t=t.replace(/~B(.+?)~A/g,function(t,e){for(var n=e,i=4-n.length%4,r=0;i>r;r++)n+=" ";return n}),t=t.replace(/~A/g,"    "),t=t.replace(/~B/g,"")},j=function(t,e,n){var i="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(i="\\\\"+i);var r=new RegExp(i,"g");return t=t.replace(r,I)},I=function(t,e){var n=e.charCodeAt(0);return"~E"+n+"E"}},function(){var t=[].slice;this.Mercury||(this.Mercury={}),jQuery.extend(this.Mercury,{version:"0.9.0",Regions:Mercury.Regions||{},modalHandlers:Mercury.modalHandlers||{},lightviewHandlers:Mercury.lightviewHandlers||{},dialogHandlers:Mercury.dialogHandlers||{},preloadedViews:Mercury.preloadedViews||{},ajaxHeaders:function(){var t;return t={},t[Mercury.config.csrfHeader]=Mercury.csrfToken,t},on:function(t,e){return jQuery(window).on("mercury:"+t,e)},off:function(t,e){return jQuery(window).off("mercury:"+t,e)},one:function(t,e){return jQuery(window).one("mercury:"+t,e)},trigger:function(t,e){return Mercury.log(t,e),jQuery(window).trigger("mercury:"+t,e)},notify:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],window.alert(Mercury.I18n.apply(this,e))},warn:function(t,e){var n,i;if(null==e&&(e=0),console)try{return console.warn(t)}catch(r){if(n=r,e>=1)try{return console.debug(t)}catch(r){i=r}}else if(e>=1)return Mercury.notify(t)},deprecated:function(t){return console&&console.trace&&(t=""+t+" -- "+console.trace()),Mercury.warn("deprecated: "+t,1)},log:function(){var t;if(Mercury.debug&&console){if("hide:toolbar"===arguments[0]||"show:toolbar"===arguments[0])return;try{return console.debug(arguments)}catch(e){t=e}}},locale:function(){var t,e,n;return Mercury.determinedLocale?Mercury.determinedLocale:(Mercury.config.localization.enabled&&(t=[],navigator.language&&(t=navigator.language.toString().split("-")).length&&(n=Mercury.I18n[t[0]]||{},e=t.length>1?n["_"+t[1].toUpperCase()+"_"]:void 0),Mercury.I18n[t[0]]||(t=Mercury.config.localization.preferredLocale.split("-"),n=Mercury.I18n[t[0]]||{},e=t.length>1?n["_"+t[1].toUpperCase()+"_"]:void 0)),Mercury.determinedLocale={top:n||{},sub:e||{}})},I18n:function(){var e,n,i,r;return i=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],n=Mercury.locale(),r=(n.sub[i]||n.top[i]||i||"").toString(),e.length?r.printf.apply(r,e):r}})}.call(this),function(){String.prototype.titleize=function(){return this[0].toUpperCase()+this.slice(1)},String.prototype.toHex=function(){return"#"===this[0]?this:this.replace(/rgb(a)?\(([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|.|%]+\s?)?\)/gi,function(t,e,n,i,r){return"#"+parseInt(n).toHex()+parseInt(i).toHex()+parseInt(r).toHex()})},String.prototype.regExpEscape=function(){var t,e;return e=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],t=new RegExp("(\\"+e.join("|\\")+")","g"),this.replace(t,"\\$1")},String.prototype.printf=function(){var t,e,n,i,r,o,s,a,l,c;for(n=this.split("%"),a=n[0],s=/^([sdf])([\s\S%]*)$/,r=0,i=l=0,c=n.length;c>l;i=++l)if(e=n[i],o=s.exec(e),0!==i&&o&&null!==arguments[i]){switch(t=arguments[i-1-r],o[1]){case"s":a+=t;break;case"d":case"i":a+=parseInt(t.toString(),10);break;case"f":a+=parseFloat(t)}a+=o[2]}else i>1&&(r+=2,a+="%"+e);return a},Number.prototype.toHex=function(){var t;return t=this.toString(16).toUpperCase(),t[1]?t:"0"+t},Number.prototype.toBytes=function(){var t,e;for(t=parseInt(this),e=0;t>1023;)t/=1024,e+=1;return e?""+t.toFixed(2)+[""," kb"," Mb"," Gb"," Tb"," Pb"," Eb"][e]:""+t+" bytes"}}.call(this),function(){this.Mercury.PageEditor=function(){function t(t,e){var n;if(this.saveUrl=null!=t?t:null,this.options=null!=e?e:{},window.mercuryInstance)throw Mercury.I18n("Mercury.PageEditor can only be instantiated once.");this.options.visible!==!1&&"false"!==this.options.visible&&(this.options.visible=!0),this.visible=this.options.visible,this.options.saveDataType===!1||this.options.saveDataType||(this.options.saveDataType="json"),window.mercuryInstance=this,this.regions=[],this.initializeInterface(),(n=jQuery(Mercury.config.csrfSelector).attr("content"))&&(Mercury.csrfToken=n)}return t.prototype.initializeInterface=function(){var t,e;return this.focusableElement=jQuery("<input>",{"class":"mercury-focusable",type:"text"}).appendTo(null!=(t=this.options.appendTo)?t:"body"),this.iframe=jQuery("<iframe>",{id:"mercury_iframe","class":"mercury-iframe",frameborder:"0",src:"about:blank"}),this.iframe.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body"),this.toolbar=new Mercury.Toolbar(jQuery.extend(!0,{},this.options,this.options.toolbarOptions)),this.statusbar=new Mercury.Statusbar(jQuery.extend(!0,{},this.options,this.options.statusbarOptions)),this.resize(),this.iframe.one("load",function(t){return function(){return t.bindEvents()}}(this)),this.iframe.on("load",function(t){return function(){return t.initializeFrame()}}(this)),this.loadIframeSrc(null)},t.prototype.initializeFrame=function(){var t,e;try{if(this.iframe.data("loaded"))return;return this.iframe.data("loaded",!0),this.document=jQuery(this.iframe.get(0).contentWindow.document),jQuery('<style mercury-styles="true">').html(Mercury.config.injectedStyles).appendTo(this.document.find("head")),e=this.iframe.get(0).contentWindow,jQuery.globalEval=function(t){return t&&/\S/.test(t)?(e.execScript||function(t){return e.eval.call(e,t)})(t):void 0},e.Mercury=Mercury,window.History&&History.Adapter&&(e.History=History),this.bindDocumentEvents(),this.resize(),this.initializeRegions(),this.finalizeInterface(),Mercury.trigger("ready"),e.jQuery&&e.jQuery(e).trigger("mercury:ready"),e.Event&&e.Event.fire&&e.Event.fire(e,"mercury:ready"),e.onMercuryReady&&e.onMercuryReady(),this.iframe.css({visibility:"visible"})}catch(n){return t=n,Mercury.notify("Mercury.PageEditor failed to load: %s\n\nPlease try refreshing.",t)}},t.prototype.initializeRegions=function(){var t,e,n,i,r,o,s,a;for(this.regions=[],o=jQuery("["+Mercury.config.regions.attribute+"]",this.document),e=0,i=o.length;i>e;e++)t=o[e],this.buildRegion(jQuery(t));if(this.visible){for(s=this.regions,a=[],n=0,r=s.length;r>n;n++){if(t=s[n],t.focus){t.focus();break}a.push(void 0)}return a}},t.prototype.buildRegion=function(t){var e,n;if(t.data("region"))t=t.data("region");else{if(e=(t.attr(Mercury.config.regions.attribute)||("function"==typeof(n=Mercury.config.regions).determineType?n.determineType(t):void 0)||"unknown").titleize(),"Unknown"===e||!Mercury.Regions[e])throw Mercury.I18n('Region type is malformed, no data-type provided, or "%s" is unknown for the "%s" region.',e,t.attr("id")||"unknown");if(!Mercury.Regions[e].supported)return Mercury.notify("Mercury.Regions.%s is unsupported in this client. Supported browsers are %s.",e,Mercury.Regions[e].supportedText),!1;t=new Mercury.Regions[e](t,this.iframe.get(0).contentWindow),this.previewing&&t.togglePreview()}return this.regions.push(t)},t.prototype.finalizeInterface=function(){var t;return this.santizerElement=jQuery("<div>",{id:"mercury_sanitizer",contenteditable:"true",style:"position:fixed;width:100px;height:100px;min-width:0;top:0;left:-100px;opacity:0;overflow:hidden"}),this.santizerElement.appendTo(null!=(t=this.options.appendTo)?t:this.document.find("body")),this.snippetToolbar&&this.snippetToolbar.release(),this.snippetToolbar=new Mercury.SnippetToolbar(this.document),this.hijackLinksAndForms(),this.visible?void 0:Mercury.trigger("mode",{mode:"preview"})},t.prototype.bindDocumentEvents=function(){return this.document.on("mousedown",function(t){return Mercury.trigger("hide:dialogs"),Mercury.region&&jQuery(t.target).closest("["+Mercury.config.regions.attribute+"]").get(0)!==Mercury.region.element.get(0)?Mercury.trigger("unfocus:regions"):void 0}),jQuery(this.document).bind("keydown",function(){return function(t){return(t.ctrlKey||t.metaKey)&&83===t.keyCode?(Mercury.trigger("action",{action:"save"}),t.preventDefault()):void 0}}(this))},t.prototype.bindEvents=function(){return Mercury.on("initialize:frame",function(t){return function(){return setTimeout(t.initializeFrame,100)}}(this)),Mercury.on("focus:frame",function(t){return function(){return t.iframe.focus()}}(this)),Mercury.on("focus:window",function(t){return function(){return setTimeout(function(){return t.focusableElement.focus()},10)}}(this)),Mercury.on("toggle:interface",function(t){return function(){return t.toggleInterface()}}(this)),Mercury.on("reinitialize",function(t){return function(){return t.initializeRegions()}}(this)),Mercury.on("mode",function(t){return function(e,n){return"preview"===n.mode?t.previewing=!t.previewing:void 0}}(this)),Mercury.on("action",function(t){return function(e,n){var i;return i=Mercury.config.globalBehaviors[n.action]||t[n.action],"function"==typeof i?(e.preventDefault(),i.call(t,n)):void 0}}(this)),jQuery(window).on("resize",function(t){return function(){return t.resize()}}(this)),jQuery(window).bind("keydown",function(){return function(t){return(t.ctrlKey||t.metaKey)&&83===t.keyCode?(Mercury.trigger("action",{action:"save"}),t.preventDefault()):void 0}}(this)),window.onbeforeunload=this.beforeUnload},t.prototype.toggleInterface=function(){return this.visible?(this.visible=!1,this.toolbar.hide(),this.statusbar.hide(),this.previewing||Mercury.trigger("mode",{mode:"preview"}),this.previewing=!0,this.resize()):(this.visible=!0,this.iframe.animate({top:this.toolbar.height(!0)},200,"easeInOutSine",function(t){return function(){return t.resize()}}(this)),this.toolbar.show(),this.statusbar.show(),Mercury.trigger("mode",{mode:"preview"}),this.previewing=!1)},t.prototype.resize=function(){var t,e,n;return n=jQuery(window).width(),t=this.statusbar.top(),e=this.toolbar.top()+this.toolbar.height(),Mercury.displayRect={top:e,left:0,width:n,height:t-e,fullHeight:t},this.iframe.css({top:e,left:0,height:t-e}),Mercury.trigger("resize")},t.prototype.iframeSrc=function(t,e){var n;return null==t&&(t=null),null==e&&(e=!1),t=(null!=t?t:window.location.href).replace(null!=(n=Mercury.config).editorUrlRegEx?n.editorUrlRegEx:n.editorUrlRegEx=/([http|https]:\/\/.[^\/]*)\/editor\/?(.*)/i,"$1/$2"),t=t.replace(/[\?|\&]mercury_frame=true/gi,""),t=t.replace(/\&_=\d+/gi,""),e?""+t+(t.indexOf("?")>-1?"&":"?")+"mercury_frame=true&_="+(new Date).getTime():t},t.prototype.loadIframeSrc=function(t){return this.document&&this.document.off(),this.iframe.data("loaded",!1),this.iframe.get(0).contentWindow.document.location.href=this.iframeSrc(t,!0)},t.prototype.hijackLinksAndForms=function(){var t,e,n,i,r,o,s,a,l,c;for(a=jQuery("a, form",this.document),c=[],i=0,o=a.length;o>i;i++){for(e=a[i],n=!1,l=Mercury.config.nonHijackableClasses||[],r=0,s=l.length;s>r;r++)t=l[r],jQuery(e).hasClass(t)&&(n=!0);c.push(n||""!==e.target&&"_self"!==e.target||jQuery(e).closest("["+Mercury.config.regions.attribute+"]").length?void 0:jQuery(e).attr("target","_parent"))}return c},t.prototype.beforeUnload=function(){return Mercury.changes&&!Mercury.silent?Mercury.I18n("You have unsaved changes.  Are you sure you want to leave without saving them first?"):null},t.prototype.getRegionByName=function(t){var e,n,i,r;for(r=this.regions,n=0,i=r.length;i>n;n++)if(e=r[n],e.name===t)return e;return null},t.prototype.save=function(t){var e,n,i,r,o,s;return r=null!=(o=null!=(s=this.saveUrl)?s:Mercury.saveUrl)?o:this.iframeSrc(),e=this.serialize(),e={content:e},"POST"===this.options.saveMethod?n="POST":(n="PUT",e._method=n),Mercury.log("saving",e),i={headers:Mercury.ajaxHeaders(),type:n,dataType:this.options.saveDataType,data:e,success:function(){return function(e){return Mercury.changes=!1,Mercury.trigger("saved",e),"function"==typeof t?t():void 0}}(this),error:function(){return function(t){return Mercury.trigger("save_failed",t),Mercury.notify("Mercury was unable to save to the url: %s",r)}}(this)},"form"!==this.options.saveStyle&&(i.data=jQuery.toJSON(e),i.contentType="application/json"),jQuery.ajax(r,i)},t.prototype.serialize=function(){var t,e,n,i,r;for(e={},r=this.regions,n=0,i=r.length;i>n;n++)t=r[n],e[t.name]=t.serialize();return e},t}()}.call(this),function(){this.Mercury.HistoryBuffer=function(){function t(t){this.maxLength=null!=t?t:200,this.index=0,this.stack=[],this.markerRegExp=/<em class="mercury-marker"><\/em>/g}return t.prototype.push=function(t){if("string"===jQuery.type(t)){if(this.stack[this.index]&&this.stack[this.index].replace(this.markerRegExp,"")===t.replace(this.markerRegExp,""))return}else if("object"===jQuery.type(t)&&t.html&&this.stack[this.index]&&this.stack[this.index].html===t.html)return;return this.stack=this.stack.slice(0,this.index+1),this.stack.push(t),this.stack.length>this.maxLength&&this.stack.shift(),this.index=this.stack.length-1},t.prototype.undo=function(){return this.index<1?null:(this.index-=1,this.stack[this.index])},t.prototype.redo=function(){return this.index>=this.stack.length-1?null:(this.index+=1,this.stack[this.index])},t}()}.call(this),function(){this.Mercury.tableEditor=function(t,e,n){return Mercury.tableEditor.load(t,e,n),Mercury.tableEditor},jQuery.extend(Mercury.tableEditor,{load:function(t,e,n){return this.table=t,this.cell=e,this.cellContent=null!=n?n:"",this.row=this.cell.parent("tr"),this.columnCount=this.getColumnCount(),this.rowCount=this.getRowCount()},addColumnBefore:function(){return this.addColumn("before")},addColumnAfter:function(){return this.addColumn("after")},addColumn:function(t){var e,n,i,r,o,s,a,l,c,u,h,d;for(null==t&&(t="after"),l=this.cellSignatureFor(this.cell),h=this.table.find("tr"),d=[],e=c=0,u=h.length;u>c;e=++c)s=h[e],a=1,i="after"===t?{right:l.right}:{left:l.left},(r=this.findCellByOptionsFor(s,i))?(o=jQuery("<"+r.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(o,r.height),"before"===t?r.cell.before(o):r.cell.after(o),d.push(e+=r.height-1)):d.push((n=this.findCellByIntersectionFor(s,l))?this.setColspanFor(n.cell,n.width+1):void 0);return d},removeColumn:function(){var t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m;if(a=this.cellSignatureFor(this.cell),!(a.width>1)){for(o=[],t=[],f=this.table.find("tr"),n=l=0,h=f.length;h>l;n=++l)s=f[n],(r=this.findCellByOptionsFor(s,{left:a.left,width:a.width}))?(o.push(r.cell),n+=r.height-1):(i=this.findCellByIntersectionFor(s,a))&&t.push(i.cell);for(c=0,d=o.length;d>c;c++)e=o[c],jQuery(e).remove();for(m=[],u=0,p=t.length;p>u;u++)e=t[u],m.push(this.setColspanFor(e,this.colspanFor(e)-1));return m}},addRowBefore:function(){return this.addRow("before")},addRowAfter:function(){return this.addRow("after")},addRow:function(t){var e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v;for(null==t&&(t="after"),o=jQuery("<tr>"),(l=this.rowspanFor(this.cell))>1&&"after"===t&&(this.row=jQuery(this.row.nextAll("tr")[l-2])),n=0,m=this.row.find("th, td"),c=0,d=m.length;d>c;c++)e=m[c],i=this.colspanFor(e),r=jQuery("<"+e.tagName+">").html(this.cellContent),this.setColspanFor(r,i),n+=i,(l=this.rowspanFor(e))>1&&"after"===t?this.setRowspanFor(e,l+1):o.append(r);if(n<this.columnCount)for(a=0,g=this.row.prevAll("tr"),u=0,p=g.length;p>u;u++)for(s=g[u],a+=1,v=jQuery(s).find("td[rowspan], th[rowspan]"),h=0,f=v.length;f>h;h++)e=v[h],l=this.rowspanFor(e),l-1>=a&&"before"===t?this.setRowspanFor(e,l+1):l-1>=a&&"after"===t&&(l-1===a?(r=jQuery("<"+e.tagName+">").html(this.cellContent),this.setColspanFor(r,this.colspanFor(e)),o.append(r)):this.setRowspanFor(e,l+1));return"before"===t?this.row.before(o):this.row.after(o)},removeRow:function(){var t,e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,w,x,C,T;for(l=!0,o=0,r=0,b=this.row.find("td, th"),u=0,f=b.length;f>u;u++)e=b[u],a=this.rowspanFor(e),o&&a!==o&&(l=!1),(r>a||!r)&&(r=a),o=a;if(l||!(this.rowspanFor(this.cell)>r)){if(r>1)for(n=h=0,w=r-2;w>=0?w>=h:h>=w;n=w>=0?++h:--h)jQuery(this.row.nextAll("tr")[n]).remove();for(x=this.row.find("td[rowspan], th[rowspan]"),d=0,m=x.length;m>d;d++)e=x[d],c=this.cellSignatureFor(e),c.height!==r&&(i=this.findCellByOptionsFor(this.row.nextAll("tr")[r-1],{left:c.left,forceAdjacent:!0}))&&(this.setRowspanFor(e,this.rowspanFor(e)-this.rowspanFor(this.cell)),"before"===i.direction?i.cell.before(jQuery(e).clone()):i.cell.after(jQuery(e).clone()));if(this.columnsFor(this.row.find("td, th"))<this.columnCount)for(s=0,C=this.row.prevAll("tr"),p=0,g=C.length;g>p;p++)for(t=C[p],s+=1,T=jQuery(t).find("td[rowspan], th[rowspan]"),y=0,v=T.length;v>y;y++)e=T[y],a=this.rowspanFor(e),a>s&&this.setRowspanFor(e,a-this.rowspanFor(this.cell));return this.row.remove()}},increaseColspan:function(){var t;return t=this.cell.next("td, th"),!t.length||this.rowspanFor(t)!==this.rowspanFor(this.cell)||this.cellIndexFor(t)>this.cellIndexFor(this.cell)+this.colspanFor(this.cell)?void 0:(this.setColspanFor(this.cell,this.colspanFor(this.cell)+this.colspanFor(t)),t.remove())},decreaseColspan:function(){var t;if(1!==this.colspanFor(this.cell))return this.setColspanFor(this.cell,this.colspanFor(this.cell)-1),t=jQuery("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(t,this.rowspanFor(this.cell)),this.cell.after(t)},increaseRowspan:function(){var t,e,n;return n=this.cellSignatureFor(this.cell),e=this.row.nextAll("tr")[n.height-1],e&&(t=this.findCellByOptionsFor(e,{left:n.left,width:n.width}))?(this.setRowspanFor(this.cell,n.height+t.height),t.cell.remove()):void 0},decreaseRowspan:function(){var t,e,n,i;return i=this.cellSignatureFor(this.cell),1!==i.height?(n=this.row.nextAll("tr")[i.height-2],(t=this.findCellByOptionsFor(n,{left:i.left,forceAdjacent:!0}))?(e=jQuery("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setColspanFor(e,this.colspanFor(this.cell)),this.setRowspanFor(this.cell,i.height-1),"before"===t.direction?t.cell.before(e):t.cell.after(e)):void 0):void 0},getColumnCount:function(){return this.columnsFor(this.table.find("thead tr:first-child, tbody tr:first-child, tfoot tr:first-child").first().find("td, th"))},getRowCount:function(){return this.table.find("tr").length},cellIndexFor:function(t){var e,n,i,r,o,s,a,l,c,u,h,d;if(t=jQuery(t),o=t.parent("tr"),i=this.columnsFor(o.find("td, th")),r=this.columnsFor(t.prevAll("td, th")),i<this.columnCount)for(s=0,h=o.prevAll("tr"),a=0,c=h.length;c>a;a++)for(n=h[a],s+=1,d=jQuery(n).find("td[rowspan], th[rowspan]"),l=0,u=d.length;u>l;l++)e=d[l],this.rowspanFor(e)>s&&this.cellIndexFor(e)<=r&&(r+=this.colspanFor(e));return r},cellSignatureFor:function(t){var e;return e={cell:jQuery(t)},e.left=this.cellIndexFor(t),e.width=this.colspanFor(t),e.height=this.rowspanFor(t),e.right=e.left+e.width,e},findCellByOptionsFor:function(t,e){var n,i,r,o,s,a;for(a=jQuery(t).find("td, th"),o=0,s=a.length;s>o;o++){if(n=a[o],r=this.cellSignatureFor(n),"undefined"!=typeof e.right&&r.right===e.right)return r;if("undefined"!=typeof e.left)if(e.width){if(r.left===e.left&&r.width===e.width)return r}else if(e.forceAdjacent){if(e.forceAdjacent&&r.left>e.left)return i=jQuery(n).prev("td, th"),i.length?(r=this.cellSignatureFor(i),r.direction="after"):r.direction="before",r}else if(r.left===e.left)return r}return e.forceAdjacent?(r.direction="after",r):null},findCellByIntersectionFor:function(t,e){var n,i,r,o,s;for(s=jQuery(t).find("td, th"),r=0,o=s.length;o>r;r++)if(n=s[r],i=this.cellSignatureFor(n),i.right-e.left>=0&&i.right>e.left)return i;return null},columnsFor:function(t){var e,n,i,r;for(n=0,i=0,r=t.length;r>i;i++)e=t[i],n+=this.colspanFor(e);return n},colspanFor:function(t){return parseInt(jQuery(t).attr("colspan"))||1},rowspanFor:function(t){return parseInt(jQuery(t).attr("rowspan"))||1},setColspanFor:function(t,e){return jQuery(t).attr("colspan",e>1?e:null)},setRowspanFor:function(t,e){return jQuery(t).attr("rowspan",e>1?e:null)}})}.call(this),function(){this.Mercury.Dialog=function(){function t(t,e,n){this.url=t,this.name=e,this.options=null!=n?n:{},this.button=this.options["for"],this.build(),this.bindEvents(),this.preload()}return t.prototype.build=function(){var t;return this.element=jQuery("<div>",{"class":"mercury-dialog mercury-"+this.name+"-dialog loading",style:"display:none"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},t.prototype.bindEvents=function(){return this.element.on("mousedown",function(t){return t.stopPropagation()})},t.prototype.preload=function(){return this.options.preload?this.load():void 0},t.prototype.toggle=function(){return this.visible?this.hide():this.show()},t.prototype.resize=function(){return this.show()},t.prototype.show=function(){return Mercury.trigger("hide:dialogs",this),this.visible=!0,this.loaded?(this.element.css({width:"auto",height:"auto"}),this.position(this.visible)):this.position(),this.appear()},t.prototype.position=function(){},t.prototype.appear=function(){return this.element.css({display:"block",opacity:0}),this.element.animate({opacity:.95},200,"easeInOutSine",function(t){return function(){return t.loaded?void 0:t.load(function(){return t.resize()})}}(this))},t.prototype.hide=function(){return this.element.hide(),this.visible=!1},t.prototype.load=function(t){return this.url?Mercury.preloadedViews[this.url]?(this.loadContent(Mercury.preloadedViews[this.url]),Mercury.dialogHandlers[this.name]&&Mercury.dialogHandlers[this.name].call(this),t?t():void 0):jQuery.ajax(this.url,{success:function(e){return function(n){return e.loadContent(n),Mercury.dialogHandlers[e.name]&&Mercury.dialogHandlers[e.name].call(e),t?t():void 0}}(this),error:function(t){return function(){return t.hide(),t.button&&t.button.removeClass("pressed"),Mercury.notify('Mercury was unable to load %s for the "%s" dialog.',t.url,t.name)}}(this)}):void 0},t.prototype.loadContent=function(t){return this.loaded=!0,this.element.removeClass("loading"),this.element.html(t),Mercury.config.localization.enabled?this.element.localize(Mercury.locale()):void 0},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Palette=function(t){function n(t,e,i){this.url=t,this.name=e,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.build=function(){var t;return this.element=jQuery("<div>",{"class":"mercury-palette mercury-"+this.name+"-palette loading",style:"display:none"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},n.prototype.bindEvents=function(){return Mercury.on("hide:dialogs",function(t){return function(e,n){return n!==t?t.hide():void 0}}(this)),n.__super__.bindEvents.apply(this,arguments)},n.prototype.position=function(t){var e,n;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),e=this.button.position(),n=this.element.width(),e.left+n>jQuery(window).width()&&(e.left=e.left-n+this.button.width()),this.element.css({top:e.top+this.button.height(),left:e.left,display:t?"block":"none",visibility:"visible"})},n}(Mercury.Dialog)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);
return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Select=function(t){function n(t,e,i){this.url=t,this.name=e,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.build=function(){var t;return this.element=jQuery("<div>",{"class":"mercury-select mercury-"+this.name+"-select loading",style:"display:none"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},n.prototype.bindEvents=function(){return Mercury.on("hide:dialogs",function(t){return function(e,n){return n!==t?t.hide():void 0}}(this)),this.element.on("mousedown",function(){return function(t){return t.preventDefault()}}(this)),n.__super__.bindEvents.apply(this,arguments)},n.prototype.position=function(t){var e,n,i,r,o,s,a;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),s=this.button.position(),i=this.element.width(),n=this.element.height(),e=jQuery(document).height(),a=s.top+this.button.height()/2-n/2,a<s.top-100&&(a=s.top-100),20>a&&(a=20),r=this.loaded?"auto":n,a+n>=e-20&&(r=e-a-20),o=s.left,o+i>jQuery(window).width()&&(o=o-i+this.button.width()),this.element.css({top:a,left:o,height:r,display:t?"block":"none",visibility:"visible"})},n}(Mercury.Dialog)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Panel=function(t){function n(t,e,i){this.url=t,this.name=e,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.build=function(){var t;return this.element=jQuery("<div>",{"class":"mercury-panel loading",style:"display:none;"}),this.titleElement=jQuery("<h1><span>"+Mercury.I18n(this.options.title)+"</span></h1>").appendTo(this.element),this.paneElement=jQuery("<div>",{"class":"mercury-panel-pane"}).appendTo(this.element),this.options.closeButton&&jQuery("<a/>",{"class":"mercury-panel-close"}).appendTo(this.titleElement).css({opacity:0}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},n.prototype.bindEvents=function(){return Mercury.on("resize",function(t){return function(){return t.position(t.visible)}}(this)),Mercury.on("hide:panels",function(t){return function(e,n){return n!==t?(t.button.removeClass("pressed"),t.hide()):void 0}}(this)),this.titleElement.find(".mercury-panel-close").on("click",function(t){return t.preventDefault(),Mercury.trigger("hide:panels")}),this.element.on("mousedown",function(t){return t.stopPropagation()}),this.element.on("ajax:beforeSend",function(t){return function(e,n,i){return i.success=function(e){return t.loadContent(e),t.resize()}}}(this)),n.__super__.bindEvents.apply(this,arguments)},n.prototype.show=function(){return Mercury.trigger("hide:panels",this),n.__super__.show.apply(this,arguments)},n.prototype.resize=function(){var t,e,n;return this.titleElement.find(".mercury-panel-close").css({opacity:0}),this.paneElement.css({display:"none"}),n=this.element.width(),this.paneElement.css({visibility:"hidden",width:"auto",display:"block"}),e=this.element.width(),this.paneElement.css({visibility:"visible",display:"none"}),t=this.element.offset(),this.element.animate({left:t.left-(e-n),width:e},200,"easeInOutSine",function(t){return function(){return t.titleElement.find(".mercury-panel-close").animate({opacity:1},100),t.paneElement.css({display:"block",width:e}),jQuery(t.paneElement.find(".focusable").get(0)).focus(),t.makeDraggable()}}(this)),this.visible?void 0:this.hide()},n.prototype.position=function(t){var e,n,i,r,o;return this.element.css({display:"block",visibility:"hidden"}),r=this.element.offset(),e=this.element.width(),n=Mercury.displayRect.height-16,o=n-this.titleElement.outerHeight(),this.paneElement.css({height:o,overflowY:30>o?"hidden":"auto"}),this.moved||(i=Mercury.displayRect.width-e-20),8>=i&&(i=8),(this.pinned||e+r.left>Mercury.displayRect.width-20)&&(i=Mercury.displayRect.width-e-20),this.element.css({top:Mercury.displayRect.top+8,left:i,height:n,display:t?"block":"none",visibility:"visible"}),this.makeDraggable(),t?void 0:this.element.hide()},n.prototype.loadContent=function(t){return this.loaded=!0,this.element.removeClass("loading"),this.paneElement.css({visibility:"hidden"}),this.paneElement.html(t),Mercury.config.localization.enabled?this.paneElement.localize(Mercury.locale()):void 0},n.prototype.makeDraggable=function(){var t;return t=this.element.width(),this.element.draggable({handle:"h1 span",axis:"x",opacity:.7,scroll:!1,addClasses:!1,iframeFix:!0,containment:[8,0,Mercury.displayRect.width-t-20,0],stop:function(e){return function(){var n;return n=e.element.offset().left,e.moved=!0,e.pinned=n>Mercury.displayRect.width-t-30?!0:!1,!0}}(this)})},n}(Mercury.Dialog)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Mercury.modal=function(t,e){var n;return null==e&&(e={}),n=new Mercury.Modal(t,e),n.show(),n},this.Mercury.Modal=function(){function e(e,n){this.url=e,this.options=null!=n?n:{},this.hide=t(this.hide,this)}return e.prototype.show=function(t,e){var n;return null==t&&(t=null),null==e&&(e=null),this.url=t||this.url,this.options=e||this.options,(n=this.options).minWidth||(n.minWidth=400),this.options.ujsHandling!==!1&&(this.options.ujsHandling=!0),Mercury.trigger("focus:window"),this.initializeModal(),this.visible?this.update():this.appear(),this.options.content?setTimeout(function(t){return function(){return t.loadContent(t.options.content)}}(this),500):void 0},e.prototype.initializeModal=function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},e.prototype.build=function(){var t,e;return this.element=jQuery("<div>",{"class":"mercury-modal loading"}),this.element.html('<h1 class="mercury-modal-title"><span></span><a>&times;</a></h1>'),this.element.append('<div class="mercury-modal-content-container"><div class="mercury-modal-content"></div></div>'),this.overlay=jQuery("<div>",{"class":"mercury-modal-overlay"}),this.titleElement=this.element.find(".mercury-modal-title"),this.contentContainerElement=this.element.find(".mercury-modal-content-container"),this.contentElement=this.element.find(".mercury-modal-content"),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body"),this.overlay.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},e.prototype.bindEvents=function(){return Mercury.on("refresh",function(t){return function(){return t.resize(!0)}}(this)),Mercury.on("resize",function(t){return function(){return t.position()}}(this)),this.overlay.on("click",function(t){return function(){return t.options.allowHideUsingOverlay?t.hide():void 0}}(this)),this.titleElement.find("a").on("click",function(t){return function(){return t.hide()}}(this)),this.options.ujsHandling&&this.element.on("ajax:beforeSend",function(t){return function(e,n,i){return i.success=function(e){return t.loadContent(e)}}}(this)),jQuery(document).on("keydown",function(t){return function(e){return 27===e.keyCode&&t.visible?t.hide():void 0}}(this))},e.prototype.appear=function(){return this.showing=!0,this.position(),this.overlay.show(),this.overlay.animate({opacity:1},200,"easeInOutSine",function(t){return function(){return t.element.css({top:-t.element.height()}),t.setTitle(),t.element.show(),t.element.animate({top:0},200,"easeInOutSine",function(){return t.visible=!0,t.showing=!1,t.load()})}}(this))},e.prototype.resize=function(t){var e,n,i,r;return i=t?"visible":"hidden",n=this.titleElement.outerHeight(),r=this.contentElement.outerWidth(),this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto",visibility:i,display:"block"}),e=this.contentElement.outerHeight()+n,r<this.options.minWidth&&(r=this.options.minWidth),(e>Mercury.displayRect.fullHeight||this.options.fullHeight)&&(e=Mercury.displayRect.fullHeight),this.element.stop().animate({left:(Mercury.displayRect.width-r)/2,width:r,height:e},200,"easeInOutSine",function(t){return function(){var i;return t.contentElement.css({visibility:"visible",display:"block"}),t.contentPane.length?(t.contentElement.css({height:e-n,overflow:"visible"}),i=t.contentControl.length?t.contentControl.outerHeight()+10:0,t.contentPane.css({height:e-n-i-20}),t.contentPane.find(".mercury-display-pane").css({width:r-20})):t.contentElement.css({height:e-n,overflow:"auto"})}}(this))},e.prototype.position=function(){var t,e,n,i,r;return i=Mercury.displayRect.width,this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto"}),this.element.css({width:"auto",height:"auto",display:"block",visibility:"hidden"}),r=this.element.width(),e=this.element.height(),r<this.options.minWidth&&(r=this.options.minWidth),(e>Mercury.displayRect.fullHeight||this.options.fullHeight)&&(e=Mercury.displayRect.fullHeight),n=this.titleElement.outerHeight(),this.contentPane&&this.contentPane.length?(this.contentElement.css({height:e-n,overflow:"visible"}),t=this.contentControl.length?this.contentControl.outerHeight()+10:0,this.contentPane.css({height:e-n-t-20}),this.contentPane.find(".mercury-display-pane").css({width:r-20})):this.contentElement.css({height:e-n,overflow:"auto"}),this.element.css({left:(i-r)/2,width:r,height:e,display:this.visible?"block":"none",visibility:"visible"})},e.prototype.update=function(){return this.reset(),this.resize(),this.load()},e.prototype.load=function(){return this.setTitle(),this.url?(this.element.addClass("loading"),Mercury.preloadedViews[this.url]?setTimeout(function(t){return function(){return t.loadContent(Mercury.preloadedViews[t.url])}}(this),10):jQuery.ajax(this.url,{headers:Mercury.ajaxHeaders(),type:this.options.loadType||"GET",data:this.options.loadData,success:function(t){return function(e){return t.loadContent(e)}}(this),error:function(t){return function(){return t.hide(),Mercury.notify("Mercury was unable to load %s for the modal.",t.url)}}(this)})):void 0},e.prototype.loadContent=function(t,e){return null==e&&(e=null),this.initializeModal(),this.options=e||this.options,this.setTitle(),this.loaded=!0,this.element.removeClass("loading"),this.contentElement.html(t),this.contentElement.css({display:"none",visibility:"hidden"}),this.contentPane=this.element.find(".mercury-display-pane-container"),this.contentControl=this.element.find(".mercury-display-controls"),this.options.afterLoad&&this.options.afterLoad.call(this),this.options.handler&&(Mercury.modalHandlers[this.options.handler]?"function"==typeof Mercury.modalHandlers[this.options.handler]?Mercury.modalHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.modalHandlers[this.options.handler]),this.initialize()):Mercury.lightviewHandlers[this.options.handler]&&("function"==typeof Mercury.lightviewHandlers[this.options.handler]?Mercury.lightviewHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.lightviewHandlers[this.options.handler]),this.initialize()))),Mercury.config.localization.enabled&&this.element.localize(Mercury.locale()),this.element.find(".modal-close").on("click",this.hide),this.resize()},e.prototype.setTitle=function(){var t;return this.titleElement.find("span").html(Mercury.I18n(this.options.title)),t=this.titleElement.find("a"),this.options.closeButton===!1?t.hide():t.show()},e.prototype.serializeForm=function(){return this.element.find("form").serializeObject()||{}},e.prototype.reset=function(){return this.titleElement.find("span").html(""),this.contentElement.html("")},e.prototype.hide=function(){return this.showing?void 0:(this.options={},Mercury.trigger("focus:frame"),this.element.hide(),this.overlay.hide(),this.reset(),this.visible=!1)},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Mercury.lightview=function(t,e){var n;return null==e&&(e={}),(n=Mercury.lightview).instance||(n.instance=new Mercury.Lightview(t,e)),Mercury.lightview.instance.show(t,e),Mercury.lightview.instance},this.Mercury.Lightview=function(){function e(e,n){this.url=e,this.options=null!=n?n:{},this.hide=t(this.hide,this)}return e.prototype.show=function(t,e){return this.url=t||this.url,this.options=e||this.options,this.options.ujsHandling!==!1&&(this.options.ujsHandling=!0),Mercury.trigger("focus:window"),this.initializeLightview(),this.visible?this.update():this.appear(),this.options.content?setTimeout(function(t){return function(){return t.loadContent(t.options.content)}}(this),500):void 0},e.prototype.initializeLightview=function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},e.prototype.build=function(){var t,e;return this.element=jQuery("<div>",{"class":"mercury-lightview loading"}),this.element.html('<h1 class="mercury-lightview-title"><span></span></h1>'),this.element.append('<div class="mercury-lightview-content"></div>'),this.overlay=jQuery("<div>",{"class":"mercury-lightview-overlay"}),this.titleElement=this.element.find(".mercury-lightview-title"),this.options.closeButton&&this.titleElement.append('<a class="mercury-lightview-close"></a>'),this.contentElement=this.element.find(".mercury-lightview-content"),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body"),this.overlay.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},e.prototype.bindEvents=function(){return Mercury.on("refresh",function(t){return function(){return t.resize(!0)}}(this)),Mercury.on("resize",function(t){return function(){return t.visible?t.position():void 0}}(this)),this.overlay.on("click",function(t){return function(){return t.options.closeButton?void 0:t.hide()}}(this)),this.titleElement.find(".mercury-lightview-close").on("click",function(t){return function(){return t.hide()}}(this)),this.options.ujsHandling&&this.element.on("ajax:beforeSend",function(t){return function(e,n,i){return i.success=function(e){return t.loadContent(e)}}}(this)),jQuery(document).on("keydown",function(t){return function(e){return 27===e.keyCode&&t.visible?t.hide():void 0}}(this))},e.prototype.appear=function(){return this.showing=!0,this.position(),this.overlay.show().css({opacity:0}),this.overlay.animate({opacity:1},200,"easeInOutSine",function(t){return function(){return t.setTitle(),t.element.show().css({opacity:0}),t.element.stop().animate({opacity:1},200,"easeInOutSine",function(){return t.visible=!0,t.showing=!1,t.load()})}}(this))},e.prototype.resize=function(t){var e,n,i,r,o,s;return o=t?"visible":"hidden",r=Mercury.displayRect.width,i=Mercury.displayRect.fullHeight,n=this.titleElement.outerHeight(),s=this.contentElement.outerWidth(),(s>r-40||this.options.fullSize)&&(s=r-40),this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto",visibility:o,display:"block"}),e=this.contentElement.outerHeight()+n,(e>i-20||this.options.fullSize)&&(e=i-20),300>s&&(s=300),150>e&&(e=150),this.element.stop().animate({top:(i-e)/2+10,left:(Mercury.displayRect.width-s)/2,width:s,height:e},200,"easeInOutSine",function(t){return function(){var i;return t.contentElement.css({visibility:"visible",display:"block"}),t.contentPane.length?(t.contentElement.css({height:e-n,overflow:"visible"}),i=t.contentControl.length?t.contentControl.outerHeight():0,t.contentPane.css({height:e-n-i-40}),t.contentPane.find(".mercury-display-pane").css({width:s-40})):t.contentElement.css({height:e-n-30,overflow:"auto"})}}(this))},e.prototype.position=function(){var t,e,n,i,r,o;return r=Mercury.displayRect.width,i=Mercury.displayRect.fullHeight,this.contentPane&&this.contentPane.css({height:"auto"}),this.contentElement.css({height:"auto"}),this.element.css({width:"auto",height:"auto",display:"block",visibility:"hidden"}),o=this.contentElement.width()+40,e=this.contentElement.height()+this.titleElement.outerHeight()+30,(o>r-40||this.options.fullSize)&&(o=r-40),(e>i-20||this.options.fullSize)&&(e=i-20),300>o&&(o=300),150>e&&(e=150),n=this.titleElement.outerHeight(),this.contentPane&&this.contentPane.length?(this.contentElement.css({height:e-n,overflow:"visible"}),t=this.contentControl.length?this.contentControl.outerHeight():0,this.contentPane.css({height:e-n-t-40}),this.contentPane.find(".mercury-display-pane").css({width:o-40})):this.contentElement.css({height:e-n-30,overflow:"auto"}),this.element.css({top:(i-e)/2+10,left:(r-o)/2,width:o,height:e,display:this.visible?"block":"none",visibility:"visible"})},e.prototype.update=function(){return this.reset(),this.resize(),this.load()},e.prototype.load=function(){return this.setTitle(),this.url?(this.element.addClass("loading"),Mercury.preloadedViews[this.url]?setTimeout(function(t){return function(){return t.loadContent(Mercury.preloadedViews[t.url])}}(this),10):jQuery.ajax(this.url,{headers:Mercury.ajaxHeaders(),type:this.options.loadType||"GET",data:this.options.loadData,success:function(t){return function(e){return t.loadContent(e)}}(this),error:function(t){return function(){return t.hide(),Mercury.notify("Mercury was unable to load %s for the lightview.",t.url)}}(this)})):void 0},e.prototype.loadContent=function(t,e){return null==e&&(e=null),this.initializeLightview(),this.options=e||this.options,this.setTitle(),this.loaded=!0,this.element.removeClass("loading"),this.contentElement.html(t),this.contentElement.css({display:"none",visibility:"hidden"}),this.contentPane=this.element.find(".mercury-display-pane-container"),this.contentControl=this.element.find(".mercury-display-controls"),this.options.afterLoad&&this.options.afterLoad.call(this),this.options.handler&&(Mercury.modalHandlers[this.options.handler]?"function"==typeof Mercury.modalHandlers[this.options.handler]?Mercury.modalHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.modalHandlers[this.options.handler]),this.initialize()):Mercury.lightviewHandlers[this.options.handler]&&("function"==typeof Mercury.lightviewHandlers[this.options.handler]?Mercury.lightviewHandlers[this.options.handler].call(this):(jQuery.extend(this,Mercury.lightviewHandlers[this.options.handler]),this.initialize()))),Mercury.config.localization.enabled&&this.element.localize(Mercury.locale()),this.element.find(".lightview-close").on("click",this.hide),this.resize()},e.prototype.setTitle=function(){return this.titleElement.find("span").html(Mercury.I18n(this.options.title))},e.prototype.serializeForm=function(){return this.element.find("form").serializeObject()||{}},e.prototype.reset=function(){return this.titleElement.find("span").html(""),this.contentElement.html("")},e.prototype.hide=function(){return this.showing?void 0:(this.options={},Mercury.trigger("focus:frame"),this.element.hide(),this.overlay.hide(),this.reset(),this.visible=!1)},e}()}.call(this),function(){this.Mercury.Statusbar=function(){function t(t){this.options=null!=t?t:{},this.visible=this.options.visible,this.build(),this.bindEvents()}return t.prototype.build=function(){var t;return this.element=jQuery("<div>",{"class":"mercury-statusbar"}),this.aboutElement=jQuery("<a>",{"class":"mercury-statusbar-about"}).appendTo(this.element).html("Mercury Editor v"+Mercury.version),this.pathElement=jQuery("<div>",{"class":"mercury-statusbar-path"}).appendTo(this.element),this.visible||this.element.css({visibility:"hidden"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},t.prototype.bindEvents=function(){return Mercury.on("region:update",function(t){return function(e,n){return n.region&&"function"===jQuery.type(n.region.path)?t.setPath(n.region.path()):void 0}}(this)),this.aboutElement.on("click",function(){return function(){return Mercury.lightview("/mercury/lightviews/about.html",{title:"Mercury Editor v"+Mercury.version})}}(this))},t.prototype.height=function(){return this.element.outerHeight()},t.prototype.top=function(){var t,e;return e=this.element.offset().top,t=parseInt(this.element.css("bottom"))<0?e-this.element.outerHeight():e,this.visible?t:e+this.element.outerHeight()},t.prototype.setPath=function(t){var e,n,i,r;for(n=[],i=0,r=t.length;r>i;i++)e=t[i],n.push("<a>"+e.tagName.toLowerCase()+"</a>");return this.pathElement.html("<span><strong>"+Mercury.I18n("Path:")+" </strong>"+n.reverse().join(" &raquo; ")+"</span>")},t.prototype.show=function(){return this.visible=!0,this.element.css({opacity:0,visibility:"visible"}),this.element.animate({opacity:1},200,"easeInOutSine")},t.prototype.hide=function(){return this.visible=!1,this.element.css({visibility:"hidden"})},t}()}.call(this),function(){var t={}.hasOwnProperty;this.Mercury.Toolbar=function(){function e(t){this.options=null!=t?t:{},this.visible=this.options.visible,this.build(),this.bindEvents()}return e.prototype.build=function(){var e,n,i,r,o,s,a,l,c,u;this.element=jQuery("<div>",{"class":"mercury-toolbar-container",style:"width:10000px"}),this.element.css({width:"100%"}),this.element.appendTo(null!=(c=jQuery(this.options.appendTo).get(0))?c:"body"),u=Mercury.config.toolbars;for(l in u)if(t.call(u,l)&&(i=u[l],!i._custom)){a=jQuery("<div>",{"class":"mercury-toolbar mercury-"+l+"-toolbar"}).appendTo(this.element),i._regions&&a.attr("data-regions",i._regions),r=jQuery("<div>",{"class":"mercury-toolbar-button-container"}).appendTo(a);for(n in i)t.call(i,n)&&(s=i[n],"_regions"!==n&&(e=this.buildButton(n,s),e&&e.appendTo(r)));"nowrap"===r.css("white-space")&&(o=new Mercury.Toolbar.Expander(l,{appendTo:a,"for":r}),o.appendTo(this.element)),Mercury.config.toolbars.primary&&"primary"!==l&&a.addClass("disabled")}return this.visible?void 0:this.element.css({display:"none"})},e.prototype.buildButton=function(e,n){var i,r,o,s,a,l,c;if("_"===e[0])return!1;switch(jQuery.type(n)){case"array":return c=n[0],l=n[1],s=n[2],new Mercury.Toolbar.Button(e,c,l,s,{appendDialogsTo:this.element});case"object":o=new Mercury.Toolbar.ButtonGroup(e,n);for(i in n)t.call(n,i)&&(a=n[i],r=this.buildButton(i,a),r&&r.appendTo(o));return o;case"string":return jQuery("<hr>",{"class":"mercury-"+("-"===n?"line-separator":"separator")});default:throw Mercury.I18n('Unknown button structure -- please provide an array, object, or string for "%s".',e)}},e.prototype.bindEvents=function(){return Mercury.on("region:focused",function(t){return function(e,n){var i,r,o,s,a,l;for(a=t.element.find(".mercury-toolbar"),l=[],o=0,s=a.length;s>o;o++)r=a[o],r=jQuery(r),l.push((i=r.data("regions"))?i.split(",").indexOf(n.region.type())>-1?r.removeClass("disabled"):void 0:void 0);return l}}(this)),Mercury.on("region:blurred",function(t){return function(e,n){var i,r,o,s,a,l;for(a=t.element.find(".mercury-toolbar"),l=[],o=0,s=a.length;s>o;o++)r=a[o],r=jQuery(r),l.push((i=r.data("regions"))?i.split(",").indexOf(n.region.type())>-1?r.addClass("disabled"):void 0:void 0);return l}}(this)),this.element.on("click",function(){return Mercury.trigger("hide:dialogs")}),this.element.on("mousedown",function(t){return t.preventDefault()})},e.prototype.height=function(t){return null==t&&(t=!1),this.visible||t?this.element.outerHeight():0},e.prototype.top=function(){return this.visible?this.element.offset().top:0},e.prototype.show=function(){return this.visible=!0,this.element.css({top:-this.element.outerHeight(),display:"block"}),this.element.animate({top:0},200,"easeInOutSine")},e.prototype.hide=function(){return this.visible=!1,this.element.hide()},e}()}.call(this),function(){var t={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function e(t,e,n,i,r){return this.name=t,this.title=e,this.summary=null!=n?n:null,this.types=null!=i?i:{},this.options=null!=r?r:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return e.prototype.build=function(){var e,n,i,r,o,s;this.element=jQuery("<div>",{title:null!=(r=this.summary)?r:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},o=this.types,s=[];for(i in o)if(t.call(o,i))switch(e=o[i],i){case"preload":s.push(!0);break;case"regions":this.element.addClass("disabled"),s.push(this.handled[i]=jQuery.isFunction(e)?e.call(this,this.name):e);break;case"toggle":s.push(this.handled[i]=!0);break;case"mode":s.push(this.handled[i]=e===!0?this.name:e);break;case"context":s.push(this.handled[i]=jQuery.isFunction(e)?e:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),n=jQuery.isFunction(e)?e.call(this,this.name):e,s.push(this.handled[i]="string"==typeof n?new Mercury.Palette(n,this.name,this.defaultDialogOptions()):n);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),n=jQuery.isFunction(e)?e.call(this,this.name):e,s.push(this.handled[i]="string"==typeof n?new Mercury.Select(n,this.name,this.defaultDialogOptions()):n);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,n=jQuery.isFunction(e)?e.call(this,this.name):e,s.push(this.handled[i]="string"==typeof n?new Mercury.Panel(n,this.name,this.defaultDialogOptions()):n);break;case"modal":s.push(this.handled[i]=jQuery.isFunction(e)?e.call(this,this.name):e);break;case"lightview":s.push(this.handled[i]=jQuery.isFunction(e)?e.call(this,this.name):e);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',i,this.name)}return s},e.prototype.bindEvents=function(){return Mercury.on("button",function(t){return function(e,n){return n.action===t.name?t.element.click():void 0}}(this)),Mercury.on("mode",function(t){return function(e,n){return t.handled.mode===n.mode&&t.handled.toggle?t.togglePressed():void 0}}(this)),Mercury.on("region:update",function(t){return function(e,n){var i;return t.handled.context&&n.region&&"function"===jQuery.type(n.region.currentElement)?(i=n.region.currentElement(),i.length&&t.handled.context.call(t,i,n.region.element)?t.element.addClass("active"):t.element.removeClass("active")):t.element.removeClass("active")}}(this)),Mercury.on("region:focused",function(t){return function(e,n){return t.handled.regions&&n.region&&n.region.type()?t.handled.regions.indexOf(n.region.type())>-1?t.element.removeClass("disabled"):t.element.addClass("disabled"):void 0}}(this)),Mercury.on("region:blurred",function(t){return function(){return t.handled.regions?t.element.addClass("disabled"):void 0}}(this)),this.element.on("mousedown",function(t){return function(){return t.element.addClass("active")}}(this)),this.element.on("mouseup",function(t){return function(){return t.element.removeClass("active")}}(this)),this.element.on("click",function(t){return function(e){return t.element.closest(".disabled").length?void 0:t.handleClick(e)}}(this))},e.prototype.handleClick=function(e){var n,i,r,o;n=!1,o=this.handled;for(r in o)if(t.call(o,r))switch(i=o[r],r){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":n=!0,Mercury.trigger("mode",{mode:i});break;case"modal":n=this.handleModal(e);break;case"lightview":n=this.handleLightview(e);break;case"palette":case"select":case"panel":n=this.handleDialog(e,r)}return n||Mercury.trigger("action",{action:this.name}),this.options.regions&&this.options.regions.length?Mercury.trigger("focus:frame"):void 0},e.prototype.handleModal=function(){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},e.prototype.handleLightview=function(){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},e.prototype.handleDialog=function(t,e){return t.stopPropagation(),this.handled[e].toggle(),!0},e.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},e.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},e}(),this.Mercury.Toolbar.Button.contexts={backColor:function(t){return this.element.css("background-color",t.css("background-color"))},foreColor:function(t){return this.element.css("background-color",t.css("color"))},bold:function(t){var e;return e=t.css("font-weight"),"bold"===e||e>400},italic:function(t){return"italic"===t.css("font-style")},overline:function(t){var e,n,i,r;if("overline"===t.css("text-decoration"))return!0;for(r=t.parentsUntil(this.element),n=0,i=r.length;i>n;n++)if(e=r[n],"overline"===jQuery(e).css("text-decoration"))return!0;return!1},strikethrough:function(t,e){return"line-through"===t.css("text-decoration")||!!t.closest("strike",e).length},underline:function(t,e){return"underline"===t.css("text-decoration")||!!t.closest("u",e).length},subscript:function(t,e){return!!t.closest("sub",e).length},superscript:function(t,e){return!!t.closest("sup",e).length},justifyLeft:function(t){return t.css("text-align").indexOf("left")>-1},justifyCenter:function(t){return t.css("text-align").indexOf("center")>-1},justifyRight:function(t){return t.css("text-align").indexOf("right")>-1},justifyFull:function(t){return t.css("text-align").indexOf("justify")>-1},insertOrderedList:function(t,e){return!!t.closest("ol",e.element).length},insertUnorderedList:function(t,e){return!!t.closest("ul",e.element).length}}}.call(this),function(){this.Mercury.Toolbar.ButtonGroup=function(){function t(t,e){return this.name=t,this.options=null!=e?e:{},this.build(),this.bindEvents(),this.regions=this.options._regions,this.element}return t.prototype.build=function(){return this.element=jQuery("<div>",{"class":"mercury-button-group mercury-"+this.name+"-group"}),this.options._context||this.options._regions?this.element.addClass("disabled"):void 0},t.prototype.bindEvents=function(){return Mercury.on("region:update",function(t){return function(e,n){var i,r;return i=Mercury.Toolbar.ButtonGroup.contexts[t.name],i&&n.region&&"function"===jQuery.type(n.region.currentElement)?(r=n.region.currentElement(),r.length&&i.call(t,r,n.region.element)?t.element.removeClass("disabled"):t.element.addClass("disabled")):void 0}}(this)),Mercury.on("region:focused",function(t){return function(e,n){if(t.regions&&n.region&&n.region.type()){if(!(t.regions.indexOf(n.region.type())>-1))return t.element.addClass("disabled");if(!t.options._context)return t.element.removeClass("disabled")}}}(this)),Mercury.on("region:blurred",function(t){return function(){return t.options.regions?t.element.addClass("disabled"):void 0}}(this))},t}(),this.Mercury.Toolbar.ButtonGroup.contexts={table:function(t,e){return!!t.closest("table",e).length}}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Toolbar.Expander=function(t){function n(t,e){return this.name=t,this.options=e,this.container=this.options["for"],n.__super__.constructor.call(this,null,this.name,this.options),this.element}return e(n,t),n.prototype.build=function(){var t;return this.container.css({whiteSpace:"normal",visibility:"hidden",display:"block"}),this.containerWidth=this.container.outerWidth(),this.container.css({visibility:"visible"}),this.trigger=jQuery("<div>",{"class":"mercury-toolbar-expander"}).appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body"),this.element=jQuery("<div>",{"class":"mercury-palette mercury-expander mercury-"+this.name+"-expander",style:"display:none"}),this.windowResize()},n.prototype.bindEvents=function(){return Mercury.on("hide:dialogs",function(t){return function(e,n){return n!==t?t.hide():void 0}}(this)),Mercury.on("resize",function(t){return function(){return t.windowResize()}}(this)),n.__super__.bindEvents.apply(this,arguments),this.trigger.click(function(t){return function(e){var n,i,r,o,s;for(e.stopPropagation(),i=[],s=t.container.find(".mercury-button"),r=0,o=s.length;o>r;r++)n=s[r],n=jQuery(n),n.position().top>5&&i.push(n.data("expander"));return t.loadContent(i.join("")),t.toggle()}}(this)),this.element.click(function(t){return function(e){var n,i;return i=jQuery(e.target).closest("[data-button]").data("button"),n=t.container.find(".mercury-"+i+"-button"),n.click()}}(this))},n.prototype.windowResize=function(){return this.containerWidth>jQuery(window).width()?this.trigger.show():this.trigger.hide(),this.hide()},n.prototype.position=function(t){var e,n;return this.element.css({top:0,left:0,display:"block",visibility:"hidden"}),e=this.trigger.position(),n=this.element.width(),e.left+n>jQuery(window).width()&&(e.left=e.left-n+this.trigger.width()),this.element.css({top:e.top+this.trigger.height(),left:e.left,display:t?"block":"none",visibility:"visible"})},n}(Mercury.Palette)
}.call(this),function(){this.Mercury.tooltip=function(t,e,n){return null==n&&(n={}),Mercury.tooltip.show(t,e,n),Mercury.tooltip},jQuery.extend(Mercury.tooltip,{show:function(t,e,n){return this.forElement=t,this.content=e,this.options=null!=n?n:{},this.document=this.forElement.get(0).ownerDocument,this.initialize(),this.visible?this.update():this.appear()},initialize:function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},build:function(){var t;return this.element=jQuery("<div>",{"class":"mercury-tooltip"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body")},bindEvents:function(){var t,e,n,i;for(Mercury.on("resize",function(t){return function(){return t.visible?t.position():void 0}}(this)),this.element.on("mousedown",function(t){return t.preventDefault(),t.stopPropagation()}),i=this.forElement.parentsUntil(jQuery("body",this.document)),e=0,n=i.length;n>e;e++)t=i[e],t.scrollHeight>t.clientHeight&&jQuery(t).on("scroll",function(t){return function(){return t.visible?t.position():void 0}}(this));return jQuery(this.document).on("scroll",function(t){return function(){return t.visible?t.position():void 0}}(this))},appear:function(){return this.update(),this.element.show(),this.element.animate({opacity:1},200,"easeInOutSine",function(t){return function(){return t.visible=!0}}(this))},update:function(){return this.element.html(this.content),this.position()},position:function(){var t,e,n,i;return e=this.forElement.offset(),i=this.element.width(),n=e.top+(Mercury.displayRect.top-jQuery(this.document).scrollTop())+this.forElement.outerHeight(),t=e.left-jQuery(this.document).scrollLeft(),t+i+25>Mercury.displayRect.width&&(t=t-(t+i+25)-Mercury.displayRect.width),t=0>=t?0:t,this.element.css({top:n,left:t})},hide:function(){return this.initialized?(this.element.hide(),this.visible=!1):void 0}})}.call(this),function(){var t={}.hasOwnProperty;this.Mercury.Snippet=function(){function e(t,e,n){this.name=t,this.identity=e,null==n&&(n={}),this.version=0,this.data="",this.wrapperTag="div",this.history=new Mercury.HistoryBuffer,this.setOptions(n)}return e.all=[],e.displayOptionsFor=function(t,e,n){var i;return null==e&&(e={}),null==n&&(n=!0),n?Mercury.modal(this.optionsUrl(t),jQuery.extend({title:"Snippet Options",handler:"insertSnippet",snippetName:t,loadType:Mercury.config.snippets.method},e)):(i=Mercury.Snippet.create(t),Mercury.trigger("action",{action:"insertSnippet",value:i})),Mercury.snippet=null},e.optionsUrl=function(t){var e;return e=Mercury.config.snippets.optionsUrl,"function"==typeof e&&(e=e()),e.replace(":name",t)},e.previewUrl=function(t){var e;return e=Mercury.config.snippets.previewUrl,"function"==typeof e&&(e=e()),e.replace(":name",t)},e.create=function(t,e){var n;return n=new Mercury.Snippet(t,this.uniqueId(),e),this.all.push(n),n},e.uniqueId=function(){var t,e,n,i,r;for(r=[0,"snippet_0"],t=r[0],n=r[1],e=function(){var t,e,n,r;for(n=this.all,r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(i.identity);return r}.call(this);-1!==e.indexOf(n);)t+=1,n="snippet_"+t;return n},e.find=function(t){var e,n,i,r;for(r=this.all,n=0,i=r.length;i>n;n++)if(e=r[n],e.identity===t)return e;return null},e.load=function(e){var n,i,r,o;o=[];for(i in e)t.call(e,i)&&(n=e[i],r=new Mercury.Snippet(n.name,i,n),o.push(this.all.push(r)));return o},e.clearAll=function(){return delete this.all,this.all=[]},e.prototype.getHTML=function(t,e){var n;return null==e&&(e=null),n=jQuery("<"+this.wrapperTag+">",{"class":""+this.name+"-snippet",contenteditable:"false","data-snippet":this.identity,"data-version":this.version},t),n.html("["+this.identity+"]"),this.loadPreview(n,e),n},e.prototype.getText=function(){return"[--"+this.identity+"--]"},e.prototype.loadPreview=function(t,n){return null==n&&(n=null),jQuery.ajax(e.previewUrl(this.name),{headers:Mercury.ajaxHeaders(),type:Mercury.config.snippets.method,data:this.options,success:function(e){return function(i){return e.data=i,t.html(i),n?n():void 0}}(this),error:function(t){return function(){return Mercury.notify('Error loading the preview for the "%s" snippet.',t.name)}}(this)})},e.prototype.displayOptions=function(){return Mercury.snippet=this,Mercury.modal(e.optionsUrl(this.name),{title:"Snippet Options",handler:"insertSnippet",loadType:Mercury.config.snippets.method,loadData:this.options})},e.prototype.setOptions=function(t){return this.options=t,delete this.options.authenticity_token,delete this.options.utf8,this.options.wrapperTag&&(this.wrapperTag=this.options.wrapperTag),this.version+=1,this.history.push(this.options)},e.prototype.setVersion=function(t){return null==t&&(t=null),t=parseInt(t),t&&this.history.stack[t-1]?(this.version=t,this.options=this.history.stack[t-1],!0):!1},e.prototype.serialize=function(){return $.extend({name:this.name},this.options)},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.SnippetToolbar=function(n){function i(t,e){this.document=t,this.options=null!=e?e:{},this._boundEvents=[],i.__super__.constructor.call(this,this.options)}return e(i,n),i.prototype.build=function(){var e,n,i,r,o,s;this.element=jQuery("<div>",{"class":"mercury-toolbar mercury-snippet-toolbar",style:"display:none"}),this.element.appendTo(null!=(r=jQuery(this.options.appendTo).get(0))?r:"body"),o=Mercury.config.toolbars.snippets,s=[];for(n in o)t.call(o,n)&&(i=o[n],e=this.buildButton(n,i),s.push(e?e.appendTo(this.element):void 0));return s},i.prototype.bindEvents=function(){return this.bindReleasableEvent(Mercury,"show:toolbar",function(t){return function(e,n){return n.snippet?(n.snippet.mouseout(function(){return t.hide()}),t.show(n.snippet)):void 0}}(this)),this.bindReleasableEvent(Mercury,"hide:toolbar",function(t){return function(e,n){return n.type&&"snippet"===n.type?t.hide(n.immediately):void 0}}(this)),this.bindReleasableEvent(jQuery(this.document),"scroll",function(t){return function(){return t.visible?t.position():void 0}}(this)),this.element.mousemove(function(t){return function(){return clearTimeout(t.hideTimeout)}}(this)),this.element.mouseout(function(t){return function(){return t.hide()}}(this))},i.prototype.bindReleasableEvent=function(t,e,n){return t.on(e,n),this._boundEvents.push([t,e,n])},i.prototype.show=function(t){return this.snippet=t,Mercury.tooltip.hide(),this.position(),this.appear()},i.prototype.position=function(){var t,e,n;return e=this.snippet.offset(),n=e.top+Mercury.displayRect.top-jQuery(this.document).scrollTop()-this.height()+10,t=e.left-jQuery(this.document).scrollLeft(),this.element.css({top:n,left:t})},i.prototype.appear=function(){return clearTimeout(this.hideTimeout),this.visible?void 0:(this.visible=!0,this.element.css({display:"block",opacity:0}),this.element.stop().animate({opacity:1},200,"easeInOutSine"))},i.prototype.hide=function(t){return null==t&&(t=!1),clearTimeout(this.hideTimeout),t?(this.element.hide(),this.visible=!1):this.hideTimeout=setTimeout(function(t){return function(){return t.element.stop().animate({opacity:0},300,"easeInOutSine",function(){return t.element.hide()}),t.visible=!1}}(this),500)},i.prototype.release=function(){var t,e,n,i,r,o,s;for(this.element.off(),this.element.remove(),o=this._boundEvents,i=0,r=o.length;r>i;i++)s=o[i],n=s[0],t=s[1],e=s[2],n.off(t,e);return this._boundEvents=[]},i}(Mercury.Toolbar)}.call(this),function(){this.Mercury.Region=function(){function t(t,e,n){this.element=t,this.window=e,this.options=null!=n?n:{},Mercury.log("building "+this.type(),this.element,this.options),this.document=this.window.document,this.name=this.element.attr(Mercury.config.regions.identifier),this.history=new Mercury.HistoryBuffer,this.build(),this.bindEvents(),this.pushHistory(),this.element.data("region",this)}return t.prototype.type=function(){return"unknown"},t.prototype.build=function(){},t.prototype.focus=function(){},t.prototype.bindEvents=function(){return Mercury.on("mode",function(t){return function(e,n){return"preview"===n.mode?t.togglePreview():void 0}}(this)),Mercury.on("focus:frame",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:t.focus()}}(this)),Mercury.on("action",function(t){return function(e,n){return t.previewing||Mercury.region!==t||e.isDefaultPrevented()?void 0:n.action?t.execCommand(n.action,n):void 0}}(this)),this.element.on("mousemove",function(t){return function(e){var n;if(!t.previewing&&Mercury.region===t)return n=jQuery(e.target).closest("[data-snippet]"),n.length&&(t.snippet=n,t.snippet.data("snippet"))?Mercury.trigger("show:toolbar",{type:"snippet",snippet:t.snippet}):void 0}}(this)),this.element.on("mouseout",function(t){return function(){return t.previewing?void 0:Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!1})}}(this))},t.prototype.content=function(t,e){var n,i,r,o,s;if(null==t&&(t=null),null==e&&(e=!1),null!==t)return this.element.html(t);if(n=jQuery("<div>").appendTo(this.document.createDocumentFragment()),n.html(this.element.html().replace(/^\s+|\s+$/g,"")),e)for(s=n.find("[data-snippet]"),r=0,o=s.length;o>r;r++)i=s[r],i=jQuery(i),i.attr({contenteditable:null,"data-version":null}),i.html("["+i.data("snippet")+"]");return n.html()},t.prototype.togglePreview=function(){return this.previewing?(this.previewing=!1,this.element.attr(Mercury.config.regions.attribute,this.type()),Mercury.region===this?this.focus():void 0):(this.previewing=!0,this.element.removeAttr(Mercury.config.regions.attribute),Mercury.trigger("region:blurred",{region:this}))},t.prototype.execCommand=function(t,e){return null==e&&(e={}),this.focus(),"redo"!==t&&this.pushHistory(),Mercury.log("execCommand",t,e.value),Mercury.changes=!0},t.prototype.pushHistory=function(){return this.history.push(this.content())},t.prototype.snippets=function(){var t,e,n,i,r,o;for(n={},o=this.element.find("[data-snippet]"),i=0,r=o.length;r>i;i++)t=o[i],e=Mercury.Snippet.find(jQuery(t).data("snippet")),e&&(n[e.identity]=e.serialize());return n},t.prototype.dataAttributes=function(){var t,e,n,i,r;for(e={},r=Mercury.config.regions.dataAttributes,n=0,i=r.length;i>n;n++)t=r[n],e[t]=(this.container||this.element).attr("data-"+t);return e},t.prototype.serialize=function(){return{type:this.type(),data:this.dataAttributes(),value:this.content(null,!0),snippets:this.snippets()}},t}()}.call(this),function(){var t={}.hasOwnProperty;this.Mercury.uploader=function(t,e){return Mercury.config.uploading.enabled&&Mercury.uploader.show(t,e),Mercury.uploader},jQuery.extend(Mercury.uploader,{show:function(t,e){return this.options=null!=e?e:{},this.file=new Mercury.uploader.File(t),this.file.errors?void alert("Error: "+this.file.errors):this.supported()?(Mercury.trigger("focus:window"),this.initialize(),this.appear()):void 0},initialize:function(){return this.initialized?void 0:(this.build(),this.bindEvents(),this.initialized=!0)},supported:function(){var t;return t=new XMLHttpRequest,window.Uint8Array&&window.ArrayBuffer&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(t){var e,n,i,r,o;for(i=new Uint8Array(t.length),n=r=0,o=t.length;o>r;n=++r)e=t[n],i[n]=255&t.charCodeAt(n);return this.send(i.buffer)}),!(!t.upload||!t.sendAsBinary||!Mercury.uploader.fileReaderSupported()&&!Mercury.uploader.formDataSupported())},fileReaderSupported:function(){return!!window.FileReader},formDataSupported:function(){return!!window.FormData},build:function(){var t,e;return this.element=jQuery("<div>",{"class":"mercury-uploader",style:"display:none"}),this.element.append('<div class="mercury-uploader-preview"><b><img/></b></div>'),this.element.append('<div class="mercury-uploader-details"></div>'),this.element.append('<div class="mercury-uploader-progress"><span></span><div class="mercury-uploader-indicator"><div><b>0%</b></div></div></div>'),this.updateStatus("Processing..."),this.overlay=jQuery("<div>",{"class":"mercury-uploader-overlay",style:"display:none"}),this.element.appendTo(null!=(t=jQuery(this.options.appendTo).get(0))?t:"body"),this.overlay.appendTo(null!=(e=jQuery(this.options.appendTo).get(0))?e:"body")},bindEvents:function(){return Mercury.on("resize",function(t){return function(){return t.position()}}(this))},appear:function(){return this.fillDisplay(),this.position(),this.overlay.show(),this.overlay.animate({opacity:1},200,"easeInOutSine",function(t){return function(){return t.element.show(),t.element.animate({opacity:1},200,"easeInOutSine",function(){return t.visible=!0,t.loadImage()})}}(this))},position:function(){var t,e;return e=this.element.outerWidth(),t=this.element.outerHeight(),this.element.css({top:(Mercury.displayRect.height-t)/2,left:(Mercury.displayRect.width-e)/2})},fillDisplay:function(){var t;return t=[Mercury.I18n("Name: %s",this.file.name),Mercury.I18n("Size: %s",this.file.readableSize),Mercury.I18n("Type: %s",this.file.type)],this.element.find(".mercury-uploader-details").html(t.join("<br/>"))},loadImage:function(){return Mercury.uploader.fileReaderSupported()?this.file.readAsDataURL(function(t){return function(e){return t.element.find(".mercury-uploader-preview b").html(jQuery("<img>",{src:e})),t.upload()}}(this)):this.upload()},upload:function(){var t,e;return e=new XMLHttpRequest,jQuery.each(["onloadstart","onprogress","onload","onabort","onerror"],function(t){return function(n,i){return e.upload[i]=function(e){return t.uploaderEvents[i].call(t,e)}}}(this)),e.onload=function(t){return function(e){var n,i,r;if(e.currentTarget.status>=400)return t.updateStatus("Error: Unable to upload the file"),Mercury.notify("Unable to process response: %s",e.currentTarget.status),t.hide();try{if(i=Mercury.config.uploading.handler?Mercury.config.uploading.handler(e.target.responseText):jQuery.parseJSON(e.target.responseText),r=i.url||i.image.url,!r)throw"Malformed response from server.";return Mercury.trigger("action",{action:"insertImage",value:{src:r}}),t.hide()}catch(o){return n=o,t.updateStatus("Error: Unable to upload the file"),Mercury.notify("Unable to process response: %s",n),t.hide()}}}(this),e.open("post",Mercury.config.uploading.url,!0),e.setRequestHeader("Accept","application/json, text/javascript, text/html, application/xml, text/xml, */*"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader(Mercury.config.csrfHeader,Mercury.csrfToken),Mercury.uploader.fileReaderSupported()?this.file.readAsBinaryString(function(t){return function(n){var i;return i=new Mercury.uploader.MultiPartPost(Mercury.config.uploading.inputName,t.file,n),t.file.updateSize(i.delta),e.setRequestHeader("Content-Type","multipart/form-data; boundary="+i.boundary),e.sendAsBinary(i.body)}}(this)):(t=new FormData,t.append(Mercury.config.uploading.inputName,this.file.file,this.file.file.name),e.send(t))},updateStatus:function(t,e){var n;return this.element.find(".mercury-uploader-progress span").html(Mercury.I18n(t).toString()),e?(n=Math.floor(100*e/this.file.size)+"%",this.element.find(".mercury-uploader-indicator div").css({width:n}),this.element.find(".mercury-uploader-indicator b").html(n).show()):void 0},hide:function(t){return null==t&&(t=0),setTimeout(function(t){return function(){return t.element.animate({opacity:0},200,"easeInOutSine",function(){return t.overlay.animate({opacity:0},200,"easeInOutSine",function(){return t.overlay.hide(),t.element.hide(),t.reset(),t.visible=!1,Mercury.trigger("focus:frame")})})}}(this),1e3*t)},reset:function(){return this.element.find(".mercury-uploader-preview b").html(""),this.element.find(".mercury-uploader-indicator div").css({width:0}),this.element.find(".mercury-uploader-indicator b").html("0%").hide(),this.updateStatus("Processing...")},uploaderEvents:{onloadstart:function(){return this.updateStatus("Uploading...")},onprogress:function(t){return this.updateStatus("Uploading...",t.loaded)},onabort:function(){return this.updateStatus("Aborted"),this.hide(1)},onload:function(){return this.updateStatus("Successfully uploaded...",this.file.size)},onerror:function(){return this.updateStatus("Error: Unable to upload the file"),this.hide(3)}}}),Mercury.uploader.File=function(){function t(t){var e;this.file=t,this.fullSize=this.size=this.file.size||this.file.fileSize,this.readableSize=this.size.toBytes(),this.name=this.file.name||this.file.fileName,this.type=this.file.type||this.file.fileType,e=[],this.size>=Mercury.config.uploading.maxFileSize&&e.push(Mercury.I18n("Too large")),Mercury.config.uploading.allowedMimeTypes.indexOf(this.type)>-1||e.push(Mercury.I18n("Unsupported format")),e.length&&(this.errors=e.join(" / "))}return t.prototype.readAsDataURL=function(t){var e;return null==t&&(t=null),e=new FileReader,e.readAsDataURL(this.file),e.onload=function(){return function(){return t?t(e.result):void 0}}(this)},t.prototype.readAsBinaryString=function(t){var e;return null==t&&(t=null),e=new FileReader,e.readAsBinaryString(this.file),e.onload=function(){return function(){return t?t(e.result):void 0}}(this)},t.prototype.updateSize=function(t){return this.fullSize=this.size+t},t}(),Mercury.uploader.MultiPartPost=function(){function e(t,e,n,i){this.inputName=t,this.file=e,this.contents=n,this.formInputs=null!=i?i:{},this.boundary="Boundaryx20072377098235644401115438165x",this.body="",this.buildBody(),this.delta=this.body.length-this.file.size}return e.prototype.buildBody=function(){var e,n,i,r;e="--"+this.boundary,r=this.formInputs;for(n in r)t.call(r,n)&&(i=r[n],this.body+=""+e+'\r\nContent-Disposition: form-data; name="'+n+'"\r\n\r\n'+unescape(encodeURIComponent(i))+"\r\n");return this.body+=""+e+'\r\nContent-Disposition: form-data; name="'+this.inputName+'"; filename="'+this.file.name+'"\r\nContent-Type: '+this.file.type+"\r\nContent-Transfer-Encoding: binary\r\n\r\n"+this.contents+"\r\n"+e+"--"},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};this.Mercury.Regions.Full=function(t){function i(t,e,n){this.element=t,this.window=e,this.options=null!=n?n:{},i.__super__.constructor.apply(this,arguments)}var r;return e(i,t),i.supported=document.designMode&&!jQuery.browser.konqueror&&!jQuery.browser.msie,i.supportedText="Chrome 10+, Firefox 4+, Safari 5+, Opera 11.64+",r="full",i.prototype.type=function(){return r},i.prototype.build=function(){var t,e,n,i,r;for(jQuery.browser.mozilla&&""===this.content()&&this.content("&nbsp;"),this.element.data({originalOverflow:this.element.css("overflow")}),this.element.css({overflow:"auto"}),this.specialContainer=jQuery.browser.mozilla&&"DIV"!==this.element.get(0).tagName,this.element.get(0).contentEditable=!0,r=this.element.find("[data-snippet]"),n=0,i=r.length;i>n;n++)e=r[n],e.contentEditable=!1,jQuery(e).attr("data-version","1");if(!this.document.mercuryEditing){this.document.mercuryEditing=!0;try{return this.document.execCommand("styleWithCSS",!1,!1),this.document.execCommand("insertBROnReturn",!1,!0),this.document.execCommand("enableInlineTableEditing",!1,!1),this.document.execCommand("enableObjectResizing",!1,!1)}catch(o){t=o}}},i.prototype.bindEvents=function(){return i.__super__.bindEvents.apply(this,arguments),Mercury.on("region:update",function(t){return function(){var e,n,i;if(!t.previewing&&Mercury.region===t)return setTimeout(function(){return t.selection().forceSelection(t.element.get(0))},1),n=t.currentElement(),n.length?(i=n.closest("table",t.element),i.length&&Mercury.tableEditor(i,n.closest("tr, td"),"<br/>"),e=n.closest("a",t.element),e.length&&e.attr("href")?Mercury.tooltip(e,'<a href="'+e.attr("href")+'" target="_blank">'+e.attr("href")+"</a>",{position:"below"}):Mercury.tooltip.hide()):void 0}}(this)),this.element.on("dragenter",function(t){return function(e){return t.previewing?void 0:(Mercury.snippet||e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("dragover",function(t){return function(e){return t.previewing?void 0:(Mercury.snippet||e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",jQuery.browser.webkit?(clearTimeout(t.dropTimeout),t.dropTimeout=setTimeout(function(){return t.element.trigger("possible:drop")},10)):void 0)}}(this)),this.element.on("drop",function(t){return function(e){return!t.previewing&&(clearTimeout(t.dropTimeout),t.dropTimeout=setTimeout(function(){return t.element.trigger("possible:drop")},1),e.originalEvent.dataTransfer.files.length)?(e.preventDefault(),t.focus(),Mercury.uploader(e.originalEvent.dataTransfer.files[0])):void 0}}(this)),this.element.on("possible:drop",function(t){return function(){var e;if(!t.previewing)return(e=t.element.find("img[data-snippet]").get(0))?(t.focus(),Mercury.Snippet.displayOptionsFor(jQuery(e).data("snippet"),{},jQuery(e).data("options")),t.document.execCommand("undo",!1,null)):void 0}}(this)),this.element.on("paste",function(t){return function(e){if(!t.previewing&&Mercury.region===t){if(t.specialContainer)return void e.preventDefault();if(!t.pasting)return Mercury.changes=!0,t.handlePaste(e.originalEvent)}}}(this)),this.element.on("focus",function(t){return function(){return t.previewing?void 0:(Mercury.region=t,setTimeout(function(){return t.selection().forceSelection(t.element.get(0))},1),Mercury.trigger("region:focused",{region:t}))}}(this)),this.element.on("blur",function(t){return function(){return t.previewing?void 0:(Mercury.trigger("region:blurred",{region:t}),Mercury.tooltip.hide())}}(this)),this.element.on("click",function(t){return function(e){return t.previewing?jQuery(e.target).closest("a").attr("target","_parent"):void 0}}(this)),this.element.on("dblclick",function(t){return function(e){var n;if(!t.previewing)return n=jQuery(e.target).closest("img",t.element),n.length?(t.selection().selectNode(n.get(0),!0),Mercury.trigger("button",{action:"insertMedia"})):void 0}}(this)),this.element.on("mouseup",function(t){return function(){return t.previewing?void 0:(t.pushHistory(),Mercury.trigger("region:update",{region:t}))}}(this)),this.element.on("keydown",function(t){return function(e){var n;if(!t.previewing){switch(e.keyCode){case 90:if(!e.metaKey)return;return e.preventDefault(),void t.execCommand(e.shiftKey?"redo":"undo");case 13:jQuery.browser.webkit&&0===t.selection().commonAncestor().closest("li, ul, ol",t.element).length?(e.preventDefault(),t.document.execCommand("insertParagraph",!1,null)):(t.specialContainer||jQuery.browser.opera)&&(e.preventDefault(),t.document.execCommand("insertHTML",!1,"<br/>"));break;case 9:e.preventDefault(),n=t.selection().commonAncestor(),n.closest("li",t.element).length?e.shiftKey?n.parents("ul, ol").length>1&&t.execCommand("outdent"):t.execCommand("indent"):t.execCommand("insertHTML",{value:"&nbsp;&nbsp;"})}if(e.metaKey)switch(e.keyCode){case 66:t.execCommand("bold"),e.preventDefault();break;case 73:t.execCommand("italic"),e.preventDefault();break;case 85:t.execCommand("underline"),e.preventDefault()}return t.pushHistory(e.keyCode)}}}(this)),this.element.on("keyup",function(t){return function(){return t.previewing?void 0:(Mercury.trigger("region:update",{region:t}),Mercury.changes=!0)}}(this))},i.prototype.focus=function(){var t;if(Mercury.region!==this){setTimeout(function(t){return function(){return t.element.focus()}}(this),10);try{this.selection().selection.collapseToStart()}catch(e){t=e}}else setTimeout(function(t){return function(){return t.element.focus()}}(this),10);return Mercury.trigger("region:focused",{region:this}),Mercury.trigger("region:update",{region:this})},i.prototype.content=function(t,e,n){var i,r,o,s,a,l,c,u,h,d,p,f,m,g;if(null==t&&(t=null),null==e&&(e=!0),null==n&&(n=!1),null!==t){for(i=jQuery("<div>").appendTo(this.document.createDocumentFragment()),i.html(t),m=i.find("[data-snippet]"),h=0,p=m.length;p>h;h++)if(o=m[h],o.contentEditable=!1,o=jQuery(o),c=Mercury.Snippet.find(o.data("snippet")))if(o.data("version"))c.setVersion(o.data("version"));else try{u=parseInt(o.html().match(/\/(\d+)\]/)[1]),u&&(c.setVersion(u),o.attr({"data-version":u}),o.html(c.data))}catch(v){s=v}return this.element.html(i.html()),this.selection().selectMarker(this.element)}if(this.element.find("meta").remove(),n&&(l=this.selection(),l.placeMarker()),i=jQuery("<div>").appendTo(this.document.createDocumentFragment()),i.html(this.element.html().replace(/^\s+|\s+$/g,"")),e)for(g=i.find("[data-snippet]"),a=d=0,f=g.length;f>d;a=++d)o=g[a],o=jQuery(o),(c=Mercury.Snippet.find(o.data("snippet")))&&(c.data=o.html()),o.html("["+o.data("snippet")+"/"+o.data("version")+"]"),o.attr({contenteditable:null,"data-version":null});return r=i.html(),n&&l.removeMarker(),r},i.prototype.togglePreview=function(){return this.previewing?(this.element.get(0).contentEditable=!0,this.element.css({overflow:"auto"})):(this.content(this.content()),this.element.get(0).contentEditable=!1,this.element.css({overflow:this.element.data("originalOverflow")}),this.element.blur()),i.__super__.togglePreview.apply(this,arguments)},i.prototype.execCommand=function(t,e){var n,r,o;if(null==e&&(e={}),i.__super__.execCommand.apply(this,arguments),r=Mercury.config.behaviors[t]||Mercury.Regions.Full.actions[t])r.call(this,this.selection(),e);else{"indent"===t&&(o=this.element.get(0).previousSibling),"insertHTML"===t&&e.value&&e.value.get&&(e.value=jQuery("<div>").html(e.value).html());try{this.document.execCommand(t,!1,e.value)}catch(s){n=s,"indent"===t&&this.element.prev()!==o&&this.element.prev().remove()}}return this.element.find("img").one("error",function(){return jQuery(this).attr({src:"/assets/mercury/missing-image.png",title:"Image not found"})})},i.prototype.pushHistory=function(t){var e,n,i;return e=[13,46,8],i=2.5,t&&(n=e.indexOf(t)),clearTimeout(this.historyTimeout),n>=0&&n!==this.lastKnownKeyCode?this.history.push(this.content(null,!1,!0)):t?this.historyTimeout=setTimeout(function(t){return function(){return t.history.push(t.content(null,!1,!0))}}(this),1e3*i):this.history.push(this.content(null,!1,!0)),this.lastKnownKeyCode=n},i.prototype.selection=function(){return new Mercury.Regions.Full.Selection(this.window.getSelection(),this.document)},i.prototype.path=function(){var t;return t=this.selection().commonAncestor(),t?t.get(0)===this.element.get(0)?[]:t.parentsUntil(this.element):[]},i.prototype.currentElement=function(){var t,e;return t=[],e=this.selection(),e.range&&(t=e.commonAncestor(),3===t.get(0).nodeType&&(t=t.parent())),t},i.prototype.handlePaste=function(t){var e,n;return"text"===Mercury.config.pasting.sanitize&&t.clipboardData?(this.execCommand("insertHTML",{value:t.clipboardData.getData("text/plain")}),void t.preventDefault()):(n=this.selection(),n.placeMarker(),e=jQuery("#mercury_sanitizer",this.document).focus(),setTimeout(function(t){return function(){var i;return i=t.sanitize(e),n.selectMarker(t.element),n.removeMarker(),t.element.focus(),t.execCommand("insertHTML",{value:i})}}(this),1))},i.prototype.sanitize=function(t){var e,i,r,o,s,a,l,c,u,h,d,p,f,m;if(t.find("["+Mercury.config.regions.attribute+"]").remove(),t.find('[src*="webkit-fake-url://"]').remove(),Mercury.config.pasting.sanitize)switch(Mercury.config.pasting.sanitize){case"blacklist":t.find("[style]").removeAttr("style"),t.find('[class="Apple-style-span"]').removeClass("Apple-style-span"),s=t.html();break;case"whitelist":for(d=t.find("*"),l=0,u=d.length;u>l;l++){a=d[l],e=!1,p=Mercury.config.pasting.whitelist;for(r in p)if(i=p[r],a.tagName.toLowerCase()===r.toLowerCase()){for(e=!0,f=jQuery(a.attributes),c=0,h=f.length;h>c;c++)o=f[c],m=o.name,n.call(i,m)<0&&jQuery(a).removeAttr(o.name);break}e||jQuery(a).replaceWith(jQuery(a).contents())}s=t.html();break;default:s=t.text()}else s=t.html(),(s.indexOf("<!--StartFragment-->")>-1||s.indexOf('="mso-')>-1||s.indexOf("<o:")>-1||s.indexOf('="Mso')>-1)&&(s=t.text());return t.html(""),s},i.actions={insertRowBefore:function(){return Mercury.tableEditor.addRow("before")},insertRowAfter:function(){return Mercury.tableEditor.addRow("after")},insertColumnBefore:function(){return Mercury.tableEditor.addColumn("before")},insertColumnAfter:function(){return Mercury.tableEditor.addColumn("after")},deleteColumn:function(){return Mercury.tableEditor.removeColumn()},deleteRow:function(){return Mercury.tableEditor.removeRow()},increaseColspan:function(){return Mercury.tableEditor.increaseColspan()},decreaseColspan:function(){return Mercury.tableEditor.decreaseColspan()},increaseRowspan:function(){return Mercury.tableEditor.increaseRowspan()},decreaseRowspan:function(){return Mercury.tableEditor.decreaseRowspan()},undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},horizontalRule:function(){return this.execCommand("insertHTML",{value:"<hr/>"})},removeFormatting:function(t){return t.insertTextNode(t.textContent())},backColor:function(t,e){return t.wrap('<span style="background-color:'+e.value.toHex()+'">',!0)},overline:function(t){return t.wrap('<span style="text-decoration:overline">',!0)},style:function(t,e){return t.wrap('<span class="'+e.value+'">',!0)},replaceHTML:function(t,e){return this.content(e.value)},insertImage:function(t,e){return this.execCommand("insertHTML",{value:jQuery("<img/>",e.value)})},insertTable:function(t,e){return this.execCommand("insertHTML",{value:e.value})},insertLink:function(t,e){var n;return n=jQuery("<"+e.value.tagName+">",this.document).attr(e.value.attrs).html(e.value.content),t.insertNode(n)},replaceLink:function(t,e){var n,i;return n=jQuery("<"+e.value.tagName+">",this.document).attr(e.value.attrs).html(e.value.content),t.selectNode(e.node),i=jQuery("<div>").html(t.content()).find("a").html(),t.replace(jQuery(n,t.context).html(i))},insertSnippet:function(t,e){var n,i;return i=e.value,(n=this.element.find("[data-snippet="+i.identity+"]")).length&&t.selectNode(n.get(0)),t.insertNode(i.getHTML(this.document))},editSnippet:function(){var t;if(this.snippet)return t=Mercury.Snippet.find(this.snippet.data("snippet")),t.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},i}(Mercury.Region),Mercury.Regions.Full.Selection=function(){function t(t,e){this.selection=t,this.context=e,this.selection.rangeCount>=1&&(this.range=this.selection.getRangeAt(0),this.fragment=this.range.cloneContents(),this.clone=this.range.cloneRange(),this.collapsed=this.selection.isCollapsed)}return t.prototype.commonAncestor=function(t){var e;return null==t&&(t=!1),this.range?(e=this.range.commonAncestorContainer,3===e.nodeType&&t&&(e=e.parentNode),jQuery(e)):null},t.prototype.wrap=function(t,e){return null==e&&(e=!1),t=jQuery(t,this.context).html(this.fragment),e&&this.replace(t),t},t.prototype.textContent=function(){return this.content().textContent},t.prototype.htmlContent=function(){var t;return t=this.content(),jQuery("<div>").html(t).html()},t.prototype.content=function(){return this.range.cloneContents()},t.prototype.is=function(t){var e;return e=this.content(),1===jQuery(e).length&&jQuery(e.firstChild).is(t)?jQuery(e.firstChild):!1},t.prototype.forceSelection=function(t){var e,n;if(jQuery.browser.webkit)return n=this.context.createRange(),this.range?this.commonAncestor(!0).closest("[data-snippet]").length&&(e=this.context.createTextNode("\x00"),t.appendChild(e)):t.lastChild&&3===t.lastChild.nodeType&&""===t.lastChild.textContent.replace(/^[\s+|\n+]|[\s+|\n+]$/,"")?(e=t.lastChild,t.lastChild.textContent="\x00"):(e=this.context.createTextNode("\x00"),t.appendChild(e)),e?(n.setStartBefore(e),n.setEndBefore(e),this.selection.addRange(n)):void 0},t.prototype.selectMarker=function(t){var e,n;return e=t.find("em.mercury-marker"),e.length?(n=this.context.createRange(),n.setStartBefore(e.get(0)),e.length>=2&&n.setEndBefore(e.get(1)),e.remove(),this.selection.removeAllRanges(),this.selection.addRange(n)):void 0},t.prototype.placeMarker=function(){var t,e;if(this.range)return this.startMarker=jQuery('<em class="mercury-marker"/>',this.context).get(0),this.endMarker=jQuery('<em class="mercury-marker"/>',this.context).get(0),t=this.range.cloneRange(),t.collapse(!1),t.insertNode(this.endMarker),this.range.collapsed||(e=this.range.cloneRange(),e.collapse(!0),e.insertNode(this.startMarker)),this.selection.removeAllRanges(),this.selection.addRange(this.range)},t.prototype.removeMarker=function(){return jQuery(this.startMarker).remove(),jQuery(this.endMarker).remove()},t.prototype.insertTextNode=function(t){var e;return e=this.context.createTextNode(t),this.range.extractContents(),this.range.insertNode(e),this.range.selectNodeContents(e),this.selection.addRange(this.range)
},t.prototype.insertNode=function(t){return t.get&&(t=t.get(0)),"string"===jQuery.type(t)&&(t=jQuery(t,this.context).get(0)),this.range.deleteContents(),this.range.insertNode(t),this.range.selectNodeContents(t),this.selection.addRange(this.range)},t.prototype.selectNode=function(t,e){return null==e&&(e=!1),this.range.selectNode(t),e&&this.selection.removeAllRanges(),this.selection.addRange(this.range)},t.prototype.replace=function(t,e){return t.get&&(t=t.get(0)),"string"===jQuery.type(t)&&(t=jQuery(t,this.context).get(0)),this.range.deleteContents(),this.range.insertNode(t),this.range.selectNodeContents(t),this.selection.addRange(this.range),e?this.range.collapse(!1):void 0},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Regions.Image=function(t){function n(t,e,i){this.element=t,this.window=e,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments)}var i;return e(n,t),n.supported=document.getElementById,n.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",i="image",n.prototype.type=function(){return i},n.prototype.bindEvents=function(){return Mercury.on("mode",function(t){return function(e,n){return"preview"===n.mode?t.togglePreview():void 0}}(this)),Mercury.on("focus:frame",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:t.focus()}}(this)),Mercury.on("action",function(t){return function(e,n){return t.previewing||Mercury.region!==t?void 0:n.action?t.execCommand(n.action,n):void 0}}(this)),this.element.on("dragenter",function(t){return function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("dragover",function(t){return function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("drop",function(t){return function(e){return t.previewing?void 0:e.originalEvent.dataTransfer.files.length?(e.preventDefault(),t.focus(),Mercury.uploader(e.originalEvent.dataTransfer.files[0])):void 0}}(this)),this.element.on("focus",function(t){return function(){return t.focus()}}(this))},n.prototype.togglePreview=function(){return this.previewing?(this.previewing=!1,this.element.attr(Mercury.config.regions.attribute,i),this.build()):(this.previewing=!0,this.element.removeAttr(Mercury.config.regions.attribute),Mercury.trigger("region:blurred",{region:this}))},n.prototype.focus=function(){return this.previewing?void 0:(Mercury.region=this,Mercury.trigger("region:focused",{region:this}),Mercury.trigger("region:update",{region:this}))},n.prototype.execCommand=function(t,e){var i;return null==e&&(e={}),n.__super__.execCommand.apply(this,arguments),(i=Mercury.Regions.Image.actions[t])?i.call(this,e):void 0},n.prototype.pushHistory=function(){return this.history.push({src:this.element.attr("src")})},n.prototype.updateSrc=function(t){return this.element.attr("src",t)},n.prototype.serialize=function(){return{type:i,data:this.dataAttributes(),attributes:{src:this.element.attr("src")}}},n.actions={undo:function(){var t;return(t=this.history.undo())?this.updateSrc(t.src):void 0},redo:function(){var t;return(t=this.history.redo())?this.updateSrc(t.src):void 0},insertImage:function(t){return this.updateSrc(t.value.src)}},n}(Mercury.Region)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Regions.Markdown=function(t){function n(t,e,i){this.element=t,this.window=e,this.options=null!=i?i:{},n.__super__.constructor.apply(this,arguments),this.converter=new Showdown.converter}var i;return e(n,t),n.supported=document.getElementById,n.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",i="markdown",n.prototype.type=function(){return i},n.prototype.build=function(){var t,e,n;return n="100%",t=this.element.height(),e=this.element.html().replace(/^\s+|\s+$/g,"").replace("&gt;",">"),this.textarea=jQuery("<textarea>",this.document).val(e).addClass("mercury-textarea"),this.textarea.css({border:0,background:"transparent",display:"block","overflow-y":"hidden",width:n,height:t,fontFamily:'"Courier New", Courier, monospace'}),this.element.empty().append(this.textarea),this.previewElement=jQuery("<div>",this.document),this.element.append(this.previewElement),this.container=this.element,this.container.data("region",this),this.element=this.textarea,this.resize()},n.prototype.dataAttributes=function(){var t,e,n,i,r;for(e={},r=Mercury.config.regions.dataAttributes,n=0,i=r.length;i>n;n++)t=r[n],e[t]=this.container.attr("data-"+t);return e},n.prototype.bindEvents=function(){return Mercury.on("mode",function(t){return function(e,n){return"preview"===n.mode?t.togglePreview():void 0}}(this)),Mercury.on("focus:frame",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:t.focus()}}(this)),Mercury.on("action",function(t){return function(e,n){return t.previewing||Mercury.region!==t?void 0:n.action?t.execCommand(n.action,n):void 0}}(this)),Mercury.on("unfocus:regions",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:(t.element.blur(),t.container.removeClass("focus"),Mercury.trigger("region:blurred",{region:t}))}}(this)),this.element.on("dragenter",function(t){return function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("dragover",function(t){return function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("drop",function(t){return function(e){return t.previewing?void 0:(Mercury.snippet&&(e.preventDefault(),t.focus(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)),e.originalEvent.dataTransfer.files.length?(e.preventDefault(),t.focus(),Mercury.uploader(e.originalEvent.dataTransfer.files[0])):void 0)}}(this)),this.element.on("focus",function(t){return function(){return t.previewing?void 0:(Mercury.region=t,t.container.addClass("focus"),Mercury.trigger("region:focused",{region:t}))}}(this)),this.element.on("keydown",function(t){return function(e){var n,i,r,o,s,a;if(!t.previewing){switch(t.resize(),e.keyCode){case 90:if(!e.metaKey)return;return e.preventDefault(),void t.execCommand(e.shiftKey?"redo":"undo");case 13:o=t.selection(),a=t.element.val(),s=a.lastIndexOf("\n",o.start),n=a.indexOf("\n",o.end),s>n&&(n=a.length),"\n"===a[s]&&(s=a.lastIndexOf("\n",o.start-1)),"-"===a[s+1]&&(o.replace("\n- ",!1,!0),e.preventDefault()),/\d/.test(a[s+1])&&(i=a.substring(s,n),/(\d+)\./.test(i)&&(r=parseInt(RegExp.$1),o.replace("\n"+(r+=1)+". ",!1,!0),e.preventDefault()));break;case 9:e.preventDefault(),t.execCommand("insertHTML",{value:"  "})}if(e.metaKey)switch(e.keyCode){case 66:t.execCommand("bold"),e.preventDefault();break;case 73:t.execCommand("italic"),e.preventDefault();break;case 85:t.execCommand("underline"),e.preventDefault()}return t.pushHistory(e.keyCode)}}}(this)),this.element.on("keyup",function(t){return function(){return t.previewing?void 0:(Mercury.changes=!0,t.resize(),Mercury.trigger("region:update",{region:t}))}}(this)),this.element.on("mouseup",function(t){return function(){return t.previewing?void 0:(t.focus(),Mercury.trigger("region:focused",{region:t}))}}(this)),this.previewElement.on("click",function(t){return function(e){return t.previewing?$(e.target).closest("a").attr("target","_parent"):void 0}}(this))},n.prototype.focus=function(){return this.element.focus()},n.prototype.content=function(t,e){return null==t&&(t=null),null==e&&(e=!0),null!==t?"string"===jQuery.type(t)?this.element.val(t):(this.element.val(t.html),this.selection().select(t.selection.start,t.selection.end)):this.element.val()},n.prototype.contentAndSelection=function(){return{html:this.content(null,!1),selection:this.selection().serialize()}},n.prototype.togglePreview=function(){var t;return this.previewing?(this.previewing=!1,this.container.attr(Mercury.config.regions.attribute,i),this.previewElement.hide(),this.element.show(),Mercury.region===this?this.focus():void 0):(this.previewing=!0,this.container.removeAttr(Mercury.config.regions.attribute),t=this.converter.makeHtml(this.element.val()),this.previewElement.html(t),this.previewElement.show(),this.element.hide(),Mercury.trigger("region:blurred",{region:this}))},n.prototype.execCommand=function(t,e){var i;return null==e&&(e={}),n.__super__.execCommand.apply(this,arguments),(i=Mercury.Regions.Markdown.actions[t])&&i.call(this,this.selection(),e),this.resize()},n.prototype.pushHistory=function(t){var e,n,i;return e=[13,46,8],i=2.5,t&&(n=e.indexOf(t)),clearTimeout(this.historyTimeout),n>=0&&n!==this.lastKnownKeyCode?this.history.push(this.contentAndSelection()):t?this.historyTimeout=setTimeout(function(t){return function(){return t.history.push(t.contentAndSelection())}}(this),1e3*i):this.history.push(this.contentAndSelection()),this.lastKnownKeyCode=n},n.prototype.selection=function(){return new Mercury.Regions.Markdown.Selection(this.element)},n.prototype.resize=function(){return this.element.css({height:this.element.get(0).scrollHeight-100}),this.element.css({height:this.element.get(0).scrollHeight})},n.prototype.snippets=function(){},n.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertHTML:function(t,e){var n;return e.value.get&&(n=e.value.get(0))&&(e.value=jQuery("<div>").html(n).html()),t.replace(e.value,!1,!0)},insertImage:function(t,e){return t.replace("![add alt text]("+encodeURI(e.value.src)+")",!0)},insertTable:function(t,e){return t.replace(e.value.replace(/<br>|<br\/>/gi,""),!1,!0)},insertLink:function(t,e){return t.replace("["+e.value.content+"]("+e.value.attrs.href+" 'optional title')",!0)},insertUnorderedList:function(t){return t.addList("unordered")},insertOrderedList:function(t){return t.addList("ordered")},style:function(t,e){return t.wrap('<span class="'+e.value+'">',"</span>")},formatblock:function(t,e){var n,i,r;r={h1:["# "," #"],h2:["## "," ##"],h3:["### "," ###"],h4:["#### "," ####"],h5:["##### "," #####"],h6:["###### "," ######"],pre:["    ",""],blockquote:["> ",""],p:["\n","\n"]};for(i in r)n=r[i],t.unWrapLine(""+n[0],""+n[1]);return"blockquote"===e.value?void Mercury.Regions.Markdown.actions.indent.call(this,t,e):t.wrapLine(""+r[e.value][0],""+r[e.value][1])},bold:function(t){return t.wrap("**","**")},italic:function(t){return t.wrap("_","_")},subscript:function(t){return t.wrap("<sub>","</sub>")},superscript:function(t){return t.wrap("<sup>","</sup>")},indent:function(t){return t.wrapLine("> ","",!1,!0)},outdent:function(t){return t.unWrapLine("> ","",!1,!0)},horizontalRule:function(t){return t.replace("\n- - -\n")},insertSnippet:function(t,e){var n;return n=e.value,t.replace(n.getText())}},n}(Mercury.Region),Mercury.Regions.Markdown.Selection=function(){function t(t){this.element=t,this.el=this.element.get(0),this.getDetails()}return t.prototype.serialize=function(){return{start:this.start,end:this.end}},t.prototype.getDetails=function(){return this.length=this.el.selectionEnd-this.el.selectionStart,this.start=this.el.selectionStart,this.end=this.el.selectionEnd,this.text=this.element.val().substr(this.start,this.length)},t.prototype.replace=function(t,e,n){var i,r,o;return null==e&&(e=!1),null==n&&(n=!1),this.getDetails(),o=this.element.val(),r=this.element.val(),this.element.val(o.substr(0,this.start)+t+o.substr(this.end,o.length)),i=this.element.val()!==r,e&&this.select(this.start,this.start+t.length),n&&this.select(this.start+t.length,this.start+t.length),i},t.prototype.select=function(t,e){return this.start=t,this.end=e,this.element.focus(),this.el.selectionStart=this.start,this.el.selectionEnd=this.end,this.getDetails()},t.prototype.wrap=function(t,e){return this.getDetails(),this.deselectNewLines(),this.replace(t+this.text+e,""!==this.text),""===this.text?this.select(this.start+t.length,this.start+t.length):void 0},t.prototype.wrapLine=function(t,e,n,i){var r,o,s,a;return null==n&&(n=!0),null==i&&(i=!1),this.getDetails(),o=this.serialize(),a=this.element.val(),s=a.lastIndexOf("\n",this.start),r=a.indexOf("\n",this.end),s>r&&(r=a.length),"\n"===a[s]&&(s=a.lastIndexOf("\n",this.start-1)),this.select(s+1,r),this.replace(t+this.text+e,n),i?this.select(o.start+t.length,o.end+t.length):void 0},t.prototype.unWrapLine=function(t,e,n,i){var r,o,s,a,l,c,u;return null==n&&(n=!0),null==i&&(i=!1),this.getDetails(),l=this.serialize(),u=this.element.val(),c=u.lastIndexOf("\n",this.start),o=u.indexOf("\n",this.end),c>o&&(o=u.length),"\n"===u[c]&&(c=u.lastIndexOf("\n",this.start-1)),this.select(c+1,o),window.something=this.text,s=new RegExp("^"+t.regExpEscape()),a=new RegExp(""+e.regExpEscape()+"$"),r=this.replace(this.text.replace(s,"").replace(a,""),n),i&&r?this.select(l.start-t.length,l.end-t.length):void 0},t.prototype.addList=function(t){var e,n,i,r,o,s;return s=this.element.val(),o=s.lastIndexOf("\n",this.start),e=s.indexOf("\n",this.end),o>e&&(e=s.length),"\n"===s[o]&&(o=s.lastIndexOf("\n",this.start-1)),this.select(o+1,e),r=this.text.split("\n"),"unordered"===t?this.replace("- "+r.join("\n- "),!0):this.replace(function(){var t,e,o;for(o=[],n=t=0,e=r.length;e>t;n=++t)i=r[n],o.push(""+(n+1)+". "+i);return o}().join("\n"),!0)},t.prototype.deselectNewLines=function(){var t,e;return e=this.text,t=e.replace(/\n+$/g,"").length,this.select(this.start,this.start+t)},t.prototype.placeMarker=function(){return this.wrap("[mercury-marker]","[mercury-marker]")},t.prototype.removeMarker=function(){var t,e,n;return n=this.element.val(),e=n.indexOf("[mercury-marker]"),e>-1?(t=n.indexOf("[mercury-marker]",e+1)-"[mercury-marker]".length,this.element.val(this.element.val().replace(/\[mercury-marker\]/g,"")),this.select(e,t)):void 0},t.prototype.textContent=function(){return this.text},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Regions.Simple=function(t){function n(t,e,r){this.element=t,this.window=e,this.options=null!=r?r:{},Mercury.log("building "+i,this.element,this.options),n.__super__.constructor.apply(this,arguments)}var i;return e(n,t),n.supported=document.getElementById,n.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",i="simple",n.prototype.type=function(){return i},n.prototype.build=function(){var t,e,n;return"block"===this.element.css("display")?(n="100%",t=this.element.height()):(n=this.element.width(),t=this.element.height()),e=this.element.text(),this.textarea=jQuery("<textarea>",this.document).val(e).addClass("mercury-textarea"),this.textarea.css({border:0,background:"transparent","overflow-y":"hidden",width:n,height:t,fontFamily:"inherit",fontSize:"inherit",fontWeight:"inherit",fontStyle:"inherit",color:"inherit","min-height":0,padding:"0",margin:0,"border-radius":0,display:"inherit",lineHeight:"inherit",textAlign:"inherit"}),this.element.empty().append(this.textarea),this.container=this.element,this.container.data("region",this),this.element=this.textarea,this.resize()},n.prototype.bindEvents=function(){return Mercury.on("mode",function(t){return function(e,n){return"preview"===n.mode?t.togglePreview():void 0}}(this)),Mercury.on("focus:frame",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:t.focus()}}(this)),Mercury.on("action",function(t){return function(e,n){return t.previewing||Mercury.region!==t?void 0:n.action?t.execCommand(n.action,n):void 0}}(this)),Mercury.on("unfocus:regions",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:(t.element.blur(),t.container.removeClass("focus"),Mercury.trigger("region:blurred",{region:t}))}}(this)),this.bindElementEvents()},n.prototype.bindElementEvents=function(){return this.element.on("focus",function(t){return function(){return t.previewing?void 0:(Mercury.region=t,t.container.addClass("focus"),Mercury.trigger("region:focused",{region:t}))}}(this)),this.element.on("keydown",function(t){return function(e){var n,i,r,o,s,a;if(!t.previewing){switch(t.resize(),e.keyCode){case 90:if(!e.metaKey)return;return e.preventDefault(),void t.execCommand(e.shiftKey?"redo":"undo");case 13:o=t.selection(),a=t.element.val(),s=a.lastIndexOf("\n",o.start),n=a.indexOf("\n",o.end),s>n&&(n=a.length),"\n"===a[s]&&(s=a.lastIndexOf("\n",o.start-1)),"-"===a[s+1]&&o.replace("\n- ",!1,!0),/\d/.test(a[s+1])&&(i=a.substring(s,n),/(\d+)\./.test(i)&&(r=parseInt(RegExp.$1),o.replace("\n"+(r+=1)+". ",!1,!0))),e.preventDefault();break;case 9:e.preventDefault(),t.execCommand("insertHTML",{value:"  "})}return t.pushHistory(e.keyCode)}}}(this)),this.element.on("keyup",function(t){return function(){return t.previewing?void 0:(Mercury.changes=!0,t.resize(),Mercury.trigger("region:update",{region:t}))}}(this)),this.element.on("mouseup",function(t){return function(){return t.previewing?void 0:(t.focus(),Mercury.trigger("region:focused",{region:t}))}}(this)),this.element.on("paste",function(t){return function(e){if(!t.previewing&&Mercury.region===t){if(t.specialContainer)return void e.preventDefault();if(!t.pasting)return Mercury.changes=!0,t.handlePaste(e.originalEvent)}}}(this))},n.prototype.handlePaste=function(t){this.execCommand("insertHTML",{value:t.clipboardData.getData("text/plain").replace(/\n/g," ")}),t.preventDefault()},n.prototype.path=function(){return[this.container.get(0)]},n.prototype.focus=function(){return this.element.focus()},n.prototype.content=function(t,e){return null==t&&(t=null),null==e&&(e=!0),null!==t?"string"===jQuery.type(t)?this.element.val(t):(this.element.val(t.html),this.selection().select(t.selection.start,t.selection.end)):this.element.val()},n.prototype.contentAndSelection=function(){return{html:this.content(null,!1),selection:this.selection().serialize()}},n.prototype.togglePreview=function(){var t;return this.previewing?(this.previewing=!1,this.element=this.container,this.container.attr(Mercury.config.regions.attribute,i),this.build(),this.bindElementEvents(),Mercury.region===this?this.focus():void 0):(this.previewing=!0,t=jQuery("<div></div>").text(this.element.val()).html(),this.container.removeAttr(Mercury.config.regions.attribute),this.container.html(t),Mercury.trigger("region:blurred",{region:this}))},n.prototype.execCommand=function(t,e){var i;return null==e&&(e={}),n.__super__.execCommand.apply(this,arguments),(i=Mercury.Regions.Simple.actions[t])&&i.call(this,this.selection(),e),this.resize()},n.prototype.pushHistory=function(t){var e,n,i;return e=[13,46,8],i=2.5,t&&(n=e.indexOf(t)),clearTimeout(this.historyTimeout),n>=0&&n!==this.lastKnownKeyCode?this.history.push(this.contentAndSelection()):t?this.historyTimeout=setTimeout(function(t){return function(){return t.history.push(t.contentAndSelection())}}(this),1e3*i):this.history.push(this.contentAndSelection()),this.lastKnownKeyCode=n},n.prototype.selection=function(){return new Mercury.Regions.Simple.Selection(this.element)},n.prototype.resize=function(){return this.element.css({height:this.element.get(0).scrollHeight-100}),this.element.css({height:this.element.get(0).scrollHeight})},n.prototype.snippets=function(){},n.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertHTML:function(t,e){var n;return e.value.get&&(n=e.value.get(0))&&(e.value=jQuery("<div>").html(n).html()),t.replace(e.value,!1,!0)}},n}(Mercury.Region),Mercury.Regions.Simple.Selection=function(){function t(t){this.element=t,this.el=this.element.get(0),this.getDetails()}return t.prototype.serialize=function(){return{start:this.start,end:this.end}},t.prototype.getDetails=function(){return this.length=this.el.selectionEnd-this.el.selectionStart,this.start=this.el.selectionStart,this.end=this.el.selectionEnd,this.text=this.element.val().substr(this.start,this.length)},t.prototype.replace=function(t,e,n){var i,r,o;return null==e&&(e=!1),null==n&&(n=!1),this.getDetails(),o=this.element.val(),r=this.element.val(),this.element.val(o.substr(0,this.start)+t+o.substr(this.end,o.length)),i=this.element.val()!==r,e&&this.select(this.start,this.start+t.length),n&&this.select(this.start+t.length,this.start+t.length),i},t.prototype.select=function(t,e){return this.start=t,this.end=e,this.element.focus(),this.el.selectionStart=this.start,this.el.selectionEnd=this.end,this.getDetails()},t.prototype.wrap=function(t,e){return this.getDetails(),this.deselectNewLines(),this.replace(t+this.text+e,""!==this.text),""===this.text?this.select(this.start+t.length,this.start+t.length):void 0},t.prototype.deselectNewLines=function(){var t,e;return e=this.text,t=e.replace(/\n+$/g,"").length,this.select(this.start,this.start+t)},t.prototype.placeMarker=function(){return this.wrap("[mercury-marker]","[mercury-marker]")},t.prototype.removeMarker=function(){var t,e,n;return n=this.element.val(),e=n.indexOf("[mercury-marker]"),e>-1?(t=n.indexOf("[mercury-marker]",e+1)-"[mercury-marker]".length,this.element.val(this.element.val().replace(/\[mercury-marker\]/g,"")),this.select(e,t)):void 0},t.prototype.textContent=function(){return this.text},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Mercury.Regions.Snippets=function(t){function n(t,e,r){this.element=t,this.window=e,this.options=null!=r?r:{},Mercury.log("building "+i,this.element,this.options),n.__super__.constructor.apply(this,arguments),this.makeSortable()}var i;return e(n,t),n.supported=document.getElementById,n.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",i="snippets",n.prototype.type=function(){return i},n.prototype.build=function(){var t,e,n,i;for(i=this.element.find("[data-snippet]"),e=0,n=i.length;n>e;e++)t=i[e],jQuery(t).attr("data-version",0);return"0px"===this.element.css("minHeight")?this.element.css({minHeight:20}):void 0},n.prototype.bindEvents=function(){return n.__super__.bindEvents.apply(this,arguments),Mercury.on("unfocus:regions",function(t){return function(){return t.previewing?void 0:Mercury.region===t?(t.element.removeClass("focus"),t.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:t})):void 0}}(this)),Mercury.on("focus:window",function(t){return function(){return t.previewing?void 0:Mercury.region===t?(t.element.removeClass("focus"),t.element.sortable("destroy"),Mercury.trigger("region:blurred",{region:t})):void 0}}(this)),this.element.on("mouseup",function(t){return function(){return t.previewing?void 0:(t.focus(),Mercury.trigger("region:focused",{region:t}))}}(this)),this.element.on("dragover",function(t){return function(e){return t.previewing?void 0:(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy")}}(this)),this.element.on("drop",function(t){return function(e){return!t.previewing&&Mercury.snippet?(t.focus(),e.preventDefault(),Mercury.Snippet.displayOptionsFor(Mercury.snippet.name,{},Mercury.snippet.hasOptions)):void 0}}(this)),jQuery(this.document).on("keydown",function(t){return function(e){if(!t.previewing&&Mercury.region===t)switch(e.keyCode){case 90:if(!e.metaKey)return;return e.preventDefault(),t.execCommand(e.shiftKey?"redo":"undo")}}}(this)),jQuery(this.document).on("keyup",function(t){return function(){return t.previewing||Mercury.region!==t?void 0:Mercury.changes=!0}}(this))},n.prototype.focus=function(){return Mercury.region=this,this.makeSortable(),this.element.addClass("focus")},n.prototype.togglePreview=function(){return this.previewing?this.makeSortable():(this.element.sortable("destroy"),this.element.removeClass("focus")),n.__super__.togglePreview.apply(this,arguments)},n.prototype.execCommand=function(t,e){var i;return null==e&&(e={}),n.__super__.execCommand.apply(this,arguments),(i=Mercury.Regions.Snippets.actions[t])?i.call(this,e):void 0},n.prototype.makeSortable=function(){return this.element.sortable("destroy").sortable({document:this.document,scroll:!1,containment:"parent",items:"[data-snippet]",opacity:.4,revert:100,tolerance:"pointer",beforeStop:function(){return function(){return Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0}),!0}}(this),stop:function(t){return function(){return setTimeout(function(){return t.pushHistory()},100),!0}}(this)})},n.actions={undo:function(){return this.content(this.history.undo())},redo:function(){return this.content(this.history.redo())},insertSnippet:function(t){var e,n;return n=t.value,(e=this.element.find("[data-snippet="+n.identity+"]")).length?e.replaceWith(n.getHTML(this.document,function(t){return function(){return t.pushHistory()}}(this))):this.element.append(n.getHTML(this.document,function(t){return function(){return t.pushHistory()}}(this)))},editSnippet:function(){var t;if(this.snippet)return t=Mercury.Snippet.find(this.snippet.data("snippet")),t.displayOptions()},removeSnippet:function(){return this.snippet&&this.snippet.remove(),Mercury.trigger("hide:toolbar",{type:"snippet",immediately:!0})}},n}(Mercury.Region)}.call(this),function(){this.Mercury.dialogHandlers.backColor=function(){return this.element.find(".picker, .last-picked").on("click",function(t){return function(e){var n;return n=jQuery(e.target).css("background-color"),t.element.find(".last-picked").css({background:n}),t.button.css({backgroundColor:n}),Mercury.trigger("action",{action:"backColor",value:n})}}(this))}}.call(this),function(){this.Mercury.dialogHandlers.foreColor=function(){return this.element.find(".picker, .last-picked").on("click",function(t){return function(e){var n;return n=jQuery(e.target).css("background-color").toHex(),t.element.find(".last-picked").css({background:n}),t.button.css({backgroundColor:n}),Mercury.trigger("action",{action:"foreColor",value:n})}}(this))}}.call(this),function(){this.Mercury.dialogHandlers.formatblock=function(){return this.element.find("[data-tag]").on("click",function(){return function(t){var e;return e=jQuery(t.target).data("tag"),Mercury.trigger("action",{action:"formatblock",value:e})}}(this))}}.call(this),function(){this.Mercury.dialogHandlers.snippetPanel=function(){return this.element.find("input.filter").on("keyup",function(t){return function(){var e,n,i,r,o,s;for(n=t.element.find("input.filter").val(),o=t.element.find("li[data-filter]"),s=[],i=0,r=o.length;r>i;i++)e=o[i],s.push(0===LiquidMetal.score(jQuery(e).data("filter"),n)?jQuery(e).hide():jQuery(e).show());return s}}(this)),this.element.find("img[data-snippet]").on("dragstart",function(){return Mercury.snippet={name:jQuery(this).data("snippet"),hasOptions:!(jQuery(this).data("options")===!1)}})}}.call(this),function(){this.Mercury.dialogHandlers.style=function(){return this.element.find("[data-class]").on("click",function(){return function(t){var e;return e=jQuery(t.target).data("class"),Mercury.trigger("action",{action:"style",value:e})}}(this))}}.call(this),function(){this.Mercury.modalHandlers.htmlEditor=function(){var t;return t=Mercury.region.content(null,!0,!1),this.element.find("textarea").val(t),this.element.find("form").on("submit",function(t){return function(e){var n;return e.preventDefault(),n=t.element.find("textarea").val(),Mercury.trigger("action",{action:"replaceHTML",value:n}),t.hide()}}(this))}}.call(this),function(){this.Mercury.modalHandlers.insertCharacter=function(){return this.element.find(".character").on("click",function(t){return function(e){return Mercury.trigger("action",{action:"insertHTML",value:"&"+jQuery(e.target).attr("data-entity")+";"}),t.hide()}}(this))}}.call(this),function(){this.Mercury.modalHandlers.insertLink={initialize:function(){return this.editing=!1,this.content=null,this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",this.onInputFocused),this.element.find("#link_target").on("change",function(t){return function(){return t.onChangeTarget()}}(this)),this.initializeForm(),this.element.find("form").on("submit",function(t){return function(e){return e.preventDefault(),t.validateForm(),t.valid?(t.submitForm(),t.hide()):void t.resize()}}(this))},initializeForm:function(){var t,e,n,i,r,o;return this.fillExistingBookmarks(),Mercury.region&&Mercury.region.selection?(o=Mercury.region.selection(),o.textContent&&this.element.find("#link_text").val(o.textContent()),o&&o.commonAncestor&&(t=o.commonAncestor(!0).closest("a")),o.htmlContent&&(i=/<img/.test(o.htmlContent())),i||t&&t.length?(this.element.find("#link_text_container").hide(),i&&(this.content=o.htmlContent()),t&&t.length?(this.editing=t,t.attr("href")&&0===t.attr("href").indexOf("#")?(e=this.element.find("#link_existing_bookmark"),e.val(t.attr("href").replace(/[^#]*#/,"")),e.closest(".control-group").find("input[type=radio]").prop("checked",!0)):this.element.find("#link_external_url").val(t.attr("href")),t.attr("name")&&(r=this.element.find("#link_new_bookmark"),r.val(t.attr("name")),r.closest(".control-group").find("input[type=radio]").prop("checked",!0)),t.attr("target")&&this.element.find("#link_target").val(t.attr("target")),t.attr("href")&&0===t.attr("href").indexOf("javascript:void")?(n=t.attr("href"),this.element.find("#link_external_url").val(n.match(/window.open\('([^']+)',/)[1]),this.element.find("#link_target").val("popup"),this.element.find("#link_popup_width").val(n.match(/width=(\d+),/)[1]),this.element.find("#link_popup_height").val(n.match(/height=(\d+),/)[1]),this.element.find("#popup_options").show()):void 0):!1):!1):void 0},fillExistingBookmarks:function(){var t,e,n,i,r,o;for(t=this.element.find("#link_existing_bookmark"),r=jQuery("a[name]",window.mercuryInstance.document),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t.append(jQuery("<option>",{value:jQuery(e).attr("name")}).text(jQuery(e).text())));return o},onLabelChecked:function(){var t;return t=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+t).focus()},onInputFocused:function(){return jQuery(this).closest(".control-group").find("input[type=radio]").prop("checked",!0)},onChangeTarget:function(){return this.element.find(".link-target-options").hide(),this.element.find("#"+this.element.find("#link_target").val()+"_options").show(),this.resize(!0)},addInputError:function(t,e){return t.after('<span class="help-inline error-message">'+Mercury.I18n(e)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var t,e;return this.clearInputErrors(),e=this.element.find("input[name=link_type]:checked").val(),t=this.element.find("#link_"+e),t.val()||this.addInputError(t,"can't be blank"),this.editing||this.content||(t=this.element.find("#link_text"),t.val())?void 0:this.addInputError(t,"can't be blank")},submitForm:function(){var t,e,n,i,r,o;switch(n=this.element.find("#link_text").val(),i=this.element.find("#link_target").val(),r=this.element.find("input[name=link_type]:checked").val()){case"existing_bookmark":e={href:"#"+this.element.find("#link_existing_bookmark").val()};break;case"new_bookmark":e={name:""+this.element.find("#link_new_bookmark").val()};break;default:e={href:this.element.find("#link_"+r).val()}}switch(i){case"popup":t={width:parseInt(this.element.find("#link_popup_width").val())||500,height:parseInt(this.element.find("#link_popup_height").val())||500,menubar:"no",toolbar:"no"},e.href="javascript:void(window.open('"+e.href+"', 'popup_window', '"+jQuery.param(t).replace(/&/g,",")+"'))";break;default:i&&(e.target=i)}return o={tagName:"a",attrs:e,content:this.content||n},this.editing?Mercury.trigger("action",{action:"replaceLink",value:o,node:this.editing.get(0)}):Mercury.trigger("action",{action:"insertLink",value:o})}}}.call(this),function(){this.Mercury.modalHandlers.insertMedia={initialize:function(){return this.element.find(".control-label input").on("click",this.onLabelChecked),this.element.find(".controls .optional, .controls .required").on("focus",function(t){return function(e){return t.onInputFocused($(e.target))}}(this)),this.focus("#media_image_url"),this.initializeForm(),this.element.find("form").on("submit",function(t){return function(e){return e.preventDefault(),t.validateForm(),t.valid?(t.submitForm(),t.hide()):void t.resize()}}(this))},initializeForm:function(){var t,e,n,i;
if(Mercury.region&&Mercury.region.selection&&(n=Mercury.region.selection(),(e="function"==typeof n.is?n.is("img"):void 0)&&(this.element.find("#media_image_url").val(e.attr("src")),this.element.find("#media_image_alignment").val(e.attr("align")),this.element.find("#media_image_float").val(null!=e.attr("style")?e.css("float"):""),this.focus("#media_image_url")),t="function"==typeof n.is?n.is("iframe"):void 0)){if(i=t.attr("src"),/^https?:\/\/www.youtube.com\//i.test(i))return this.element.find("#media_youtube_url").val(""+i.match(/^https?/)[0]+"://youtu.be/"+i.match(/\/embed\/(\w+)/)[1]),this.element.find("#media_youtube_width").val(t.width()),this.element.find("#media_youtube_height").val(t.height()),this.focus("#media_youtube_url");if(/^https?:\/\/player.vimeo.com\//i.test(i))return this.element.find("#media_vimeo_url").val(""+i.match(/^https?/)[0]+"://vimeo.com/"+i.match(/\/video\/(\w+)/)[1]),this.element.find("#media_vimeo_width").val(t.width()),this.element.find("#media_vimeo_height").val(t.height()),this.focus("#media_vimeo_url")}},focus:function(t){return setTimeout(function(e){return function(){return e.element.find(t).focus()}}(this),300)},onLabelChecked:function(){var t;return t=jQuery(this).closest(".control-label").attr("for"),jQuery(this).closest(".control-group").find("#"+t).focus()},onInputFocused:function(t){return t.closest(".control-group").find("input[type=radio]").prop("checked",!0),t.closest(".media-options").length?void 0:(this.element.find(".media-options").hide(),this.element.find("#"+t.attr("id").replace("media_","")+"_options").show(),this.resize(!0))},addInputError:function(t,e){return t.after('<span class="help-inline error-message">'+Mercury.I18n(e)+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.element.find(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},validateForm:function(){var t,e,n;switch(this.clearInputErrors(),e=this.element.find("input[name=media_type]:checked").val(),t=this.element.find("#media_"+e),e){case"youtube_url":if(n=this.element.find("#media_youtube_url").val(),!/^https?:\/\/youtu.be\//.test(n))return this.addInputError(t,"is invalid");break;case"vimeo_url":if(n=this.element.find("#media_vimeo_url").val(),!/^https?:\/\/vimeo.com\//.test(n))return this.addInputError(t,"is invalid");break;default:if(!t.val())return this.addInputError(t,"can't be blank")}},submitForm:function(){var t,e,n,i,r,o,s,a;switch(o=this.element.find("input[name=media_type]:checked").val()){case"image_url":return e={src:this.element.find("#media_image_url").val()},(t=this.element.find("#media_image_alignment").val())&&(e.align=t),(i=this.element.find("#media_image_float").val())&&(e.style="float: "+i+";"),Mercury.trigger("action",{action:"insertImage",value:e});case"youtube_url":return s=this.element.find("#media_youtube_url").val(),n=s.replace(/https?:\/\/youtu.be\//,""),r="http",/^https:/.test(s)&&(r="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_youtube_width").val(),10)||560,height:parseInt(this.element.find("#media_youtube_height").val(),10)||349,src:""+r+"://www.youtube.com/embed/"+n+"?wmode=transparent",frameborder:0,allowfullscreen:"true"}),Mercury.trigger("action",{action:"insertHTML",value:a});case"vimeo_url":return s=this.element.find("#media_vimeo_url").val(),n=s.replace(/^https?:\/\/vimeo.com\//,""),r="http",/^https:/.test(s)&&(r="https"),a=jQuery("<iframe>",{width:parseInt(this.element.find("#media_vimeo_width").val(),10)||400,height:parseInt(this.element.find("#media_vimeo_height").val(),10)||225,src:""+r+"://player.vimeo.com/video/"+n+"?title=1&byline=1&portrait=0&color=ffffff",frameborder:0}),Mercury.trigger("action",{action:"insertHTML",value:a})}}}}.call(this),function(){this.Mercury.modalHandlers.insertSnippet=function(){return this.element.find("form").on("submit",function(t){return function(e){var n,i;return e.preventDefault(),n=t.element.find("form").serializeObject(),Mercury.snippet?(i=Mercury.snippet,i.setOptions(n),Mercury.snippet=null):i=Mercury.Snippet.create(t.options.snippetName,n),Mercury.trigger("action",{action:"insertSnippet",value:i}),t.hide()}}(this))}}.call(this),function(){this.Mercury.modalHandlers.insertTable={initialize:function(){return this.table=this.element.find("#table_display table"),this.table.on("click",function(t){return function(e){return t.onCellClick($(e.target))}}(this)),this.element.find("#table_alignment").on("change",function(t){return function(){return t.setTableAlignment()}}(this)),this.element.find("#table_border").on("keyup",function(t){return function(){return t.setTableBorder()}}(this)),this.element.find("#table_spacing").on("keyup",function(t){return function(){return t.setTableCellSpacing()}}(this)),this.element.find("[data-action]").on("click",function(t){return function(e){return e.preventDefault(),t.onActionClick(jQuery(e.target).data("action"))}}(this)),this.selectFirstCell(),this.element.find("form").on("submit",function(t){return function(e){return e.preventDefault(),t.submitForm(),t.hide()}}(this))},selectFirstCell:function(){var t;return t=this.table.find("td, th").first(),t.addClass("selected"),Mercury.tableEditor(this.table,t,"&nbsp;")},onCellClick:function(t){return this.cell=t,this.table=this.cell.closest("table"),this.table.find(".selected").removeAttr("class"),this.cell.addClass("selected"),Mercury.tableEditor(this.table,this.cell,"&nbsp;")},onActionClick:function(t){return t?Mercury.tableEditor[t]():void 0},setTableAlignment:function(){return this.table.attr({align:this.element.find("#table_alignment").val()})},setTableBorder:function(){var t;return t=parseInt(this.element.find("#table_border").val(),10),isNaN(t)?this.table.removeAttr("border"):this.table.attr({border:t})},setTableCellSpacing:function(){var t;return t=parseInt(this.element.find("#table_spacing").val(),10),isNaN(t)?this.table.removeAttr("cellspacing"):this.table.attr({cellspacing:t})},submitForm:function(){var t,e;return this.table.find(".selected").removeAttr("class"),this.table.find("td, th").html("<br/>"),t=jQuery("<div>").html(this.table).html(),e=t.replace(/^\s+|\n/gm,"").replace(/(<\/.*?>|<table.*?>|<tbody>|<tr>)/g,"$1\n"),Mercury.trigger("action",{action:"insertTable",value:e})}}}.call(this),function(){Mercury.onload&&Mercury.onload(),jQuery(window).trigger("mercury:loaded")}.call(this);